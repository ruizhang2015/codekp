<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://issues.apache.org/bugzilla/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.6"
          urlbase="https://issues.apache.org/bugzilla/"
          
          maintainer="bugzilla-admin@apache.org"
>

    <bug>
          <bug_id>50306</bug_id>
          
          <creation_ts>2010-11-19 18:09:00 +0000</creation_ts>
          <short_desc>Detect stuck threads</short_desc>
          <delta_ts>2012-07-02 14:31:27 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 7</product>
          <component>Catalina</component>
          <version>7.0.4</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P2</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Sylvain Laurent">slaurent</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>141861</commentid>
    <comment_count>0</comment_count>
    <who name="Sylvain Laurent">slaurent</who>
    <bug_when>2010-11-19 18:09:10 +0000</bug_when>
    <thetext>Feature request : 
regularly scan worker threads and if one has been processing the same request for longer than a configurable delay, log a warning with the stack trace of that thread.
This would allow to detect very long running threads, usually the ones that are stuck in a network call or in a deadlock.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>141875</commentid>
    <comment_count>1</comment_count>
    <who name="Pid">bugzilla</who>
    <bug_when>2010-11-20 15:53:38 +0000</bug_when>
    <thetext>(In reply to comment #0)
&gt; Feature request : 
&gt; regularly scan worker threads and if one has been processing the same request
&gt; for longer than a configurable delay, log a warning with the stack trace of
&gt; that thread.
&gt; This would allow to detect very long running threads, usually the ones that are
&gt; stuck in a network call or in a deadlock.

The diagnostics package Rainer &amp; I discussed included something similar to this. It&apos;s possible to use JMX to identify if a thread is associated with a request and report the properties of the request.

It&apos;s also possible to enumerate deadlocked threads using JMX.

I&apos;ve got some sample code which does various diagnostic tasks, but it&apos;s very experimental...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>141887</commentid>
    <comment_count>2</comment_count>
    <who name="Sylvain Laurent">slaurent</who>
    <bug_when>2010-11-21 15:26:18 +0000</bug_when>
    <thetext>What is this diagnostics package ? something in preparation ? Should I wait for it before working on a patch for the stuck thread detection feature ?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>141888</commentid>
    <comment_count>3</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2010-11-21 15:45:21 +0000</bug_when>
    <thetext>All of this info (except the stack trace) is already available via JMX and displayed via the Manager app. There are also plenty of tools to generate stack traces. I&apos;m struggling to see what else could be usefully done here without adding bloat.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>141919</commentid>
    <comment_count>4</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2010-11-22 09:13:44 +0000</bug_when>
    <thetext>I see basically two aspects that code inside Tomcat could add:

1) Extraction of relevant information

Since we know, which thread works on which request and we know a lot about the request meta data (e.g. when it started) and about the threads (e.g. CPU usage), we can very efficiently inspect the stacks for exactly those threads that work on the same request for longer than some configured limit. No need to dump stacks for all threads (a lot of them idle in the pools or connected to the web server but not working on a request).

2) Reduction of polling interval

Since we focus on the relevant info we can do more frequent checks than one would do with a plain &quot;dump all stacks&quot;. E.g. every 10 seconds instead of every one minute. If there is no long running request, no stack to inspect.

Yes, all of that can be done by a JMX client. But the client needs to be powerful enough to add logic like retrieving the in-flight requests, extracting those that already take to long, then retrieving the stacks for those requests etc.

What I don&apos;t have a nice idea about is how to actually use that information. Of course you could simply log the stacks and the request meta data for the long running requests, but for an average admin this might be to technical (of no real use). Though it would be helpful for his application provider when he starts analyzing reasons for performance problems.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>141922</commentid>
    <comment_count>5</comment_count>
    <who name="Konstantin Kolinko">knst.kolinko</who>
    <bug_when>2010-11-22 09:52:30 +0000</bug_when>
    <thetext>1) The manager webapp already has a list of requests being processed on the &quot;Server Status&quot; page, as Mark mentioned.

One can make them as clickable, with more info displayed on demand.

2) If some &quot;scan worker thread&quot; self-diagnostic activity is needed inside Tomcat, one can wrap it into o.a.c.LifecycleListener and add to server.xml. I doubt that there is one-fits-all solution here, but I won&apos;t stop anyone contributing.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>141933</commentid>
    <comment_count>6</comment_count>
    <who name="Sylvain Laurent">slaurent</who>
    <bug_when>2010-11-22 14:22:05 +0000</bug_when>
    <thetext>My initial idea was : if a request takes too long, log a WARNING with the stack trace of the thread processing the request.
I think that it is important to have this in log file (push information) than to just allow access by JMX (pull information) because it allows to discover problems pro-actively, for instance a network call that is stuck waiting for data from an unhealthy server and no socket timeout has been set for the call.

As for the actual implementation, it could indeed be a LifeCycleListener, but it will probably need some changes elsewhere to provide instrumentation.

I&apos;ll try to propose a patch in a couple of days.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>142982</commentid>
    <comment_count>7</comment_count>
      <attachid>26451</attachid>
    <who name="TomLu">dirtchamber</who>
    <bug_when>2010-12-29 05:02:04 +0000</bug_when>
    <thetext>Created attachment 26451
Patch for Tomcat&apos;s ThreadPoolExecutor

WebSphere has hung/stuck thread detection logic that has been very useful to us, both in development and production. But since we are moving away from WebSphere, it would be nice to have this kind of feature in Tomcat as well. Some might consider this &quot;stuck thread detection&quot; unnessesary bloat, but we have found it useful on numerous occasions. 

Applications are never perfect, and often threads will run for too long (resulting in thread leakage and pool depletion):
-External connections might hang (like URLConnection) [you can configure read/connect timeout, but not all applications has configured this]
-Loops (can be detected by excessive CPU usage)
-Loops which does not have excessive CPU usage (for example because it uses external slow IO in each loop iteration, or has Thread.sleep!! (bad coding, but it can happen))
-Deadlocks.
-Threads waiting on other hung threads.

I have created an experimental patch for Tomcat 7.0.5 that we have been using in development for a short time now.

The hung thread monitoring does the following:
Monitors active (managed) threads, and issues a warning for each thread that has been active for more than the configured threshold (seconds).
The message (log.warn) contains the thread name, stack trace, total time active, and total number of suspected hung threads. 
(In our environment, we use Cron to scan system.out, and send email if a hung thread is detected.)

A timer thread runs at a configurable interval and checks and reports hung threads, and threads previously reported to be hung, but have now finished.

It detects hung threads in the HTTP/AJP thread pools. It does not monitor all JVM threads, but since many user threads are spawned from managed &quot;webrequest&quot; threads, the HTTP/AJP threads often waits for user threads to finish, so this patch should give an indication that something is wrong in those cases as well.

If anyone is interested, I&apos;ve attached the patch. 
This patch is just an example of how such monitoring can be implemented. This is not production ready code. Performance impacts have not been considered!

The patch is for the following class:

org.apache.tomcat.util.threads.ThreadPoolExecutor

It uses 2 system properties for configuration:

org.apache.catalina.threadmonitor.interval (in seconds. Default 120)
org.apache.catalina.threadmonitor.threshold (in seconds. Default 600)

The monitoring is enabled by default, but can be disabled by setting the &quot;interval&quot; to a negative value or 0.

As stated, it only monitors managed threads created by Tomcat&apos;s HTTP/AJP thread pools.

Monitoring all JVM threads is also an option, but may require more code and might lead to many false positives..? The most important thing is to detect problems with stuck HTTP/AJP threads.

TODOs:

-Should the thread monitor properties be moved to server.xml instead of being System properties?
-Add JMX notification when hung thread detected/hung thread finished


I have no problem understanding that such a feature might not be seen as useful for everybody. We will continue to patch our own version of Tomcat anyway :)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>142989</commentid>
    <comment_count>8</comment_count>
    <who name="Pid">bugzilla</who>
    <bug_when>2010-12-29 16:47:42 +0000</bug_when>
    <thetext>If I understand the patch correctly, I disagree with the idea of an arbitrary (even if configurable) time threshold per thread.

A long running thread is not necessarily a broken one; there are existing methods in JMX for identifying deadlocked threads.

The same could be achieved with a Valve in the request processing pipeline, without modifying the Executor.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>144996</commentid>
    <comment_count>9</comment_count>
      <attachid>26769</attachid>
    <who name="TomLu">dirtchamber</who>
    <bug_when>2011-03-14 10:30:23 +0000</bug_when>
    <thetext>Created attachment 26769
New Valve: StuckThreadDetectionValve

Looking at the source, a Valve seems like a much better place for such code as you wrote. However, I still think we need some kind of a threshold (configurable or not). Deadlocked threads are not the only problem we can face. We are often experiencing problems with erronous data in our DB, which causes loops to occur. Http client request without any configured read or connect timeout can also cause a thread to appear &quot;stuck&quot;. The threads this Valve should monitor are HTTP/AJP processor threads only (not user threads), and these threads should _normally_ not be processing long running requests. Such requests should preferably be allocated to a separate thread if possible. Users who do need to execute long running request in the HTTP/AJP threads can choose not to use this Valve. This seems to be the spirit of Tomcat 7.x: create tools to help users improve their apps (Ref memory leakage detection logic). In many servers, the main HTTP request threads are considered a limited resource, and thus if such threads are running for too long, the pool will eventually be depleted. This is the case for WebSphere, which has a default max pool size of 50, and a configurable threshold for it&apos;s &quot;hung thread detection&quot; (Default 600 seconds). A valve for detecting &quot;long running threads&quot; can be quite helpful not only in development, but also in production environments in many cases. This valve should probably be disabled by default.
 
I have now moved the code i previously posted to a Valve. I have attached a patch for Tomcat 7.0.11 if anyone wants to add stuck thread detection logic to their Tomcat instance.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>145626</commentid>
    <comment_count>10</comment_count>
    <who name="Sylvain Laurent">slaurent</who>
    <bug_when>2011-04-07 17:33:10 +0000</bug_when>
    <thetext>Tom, thanks for your contribution. I committed the valve to trunk http://svn.apache.org/viewvc?view=revision&amp;revision=1090003 with the following changes :

- fixed a race condition
- removed the minimum check for the threshold
- allowed any Container
- added other information in the logged warning (request, threshold)
- exposed as JMX, including the IDS of the stuck thread
- documentation

it will be available in tomcat 7.0.13</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>160097</commentid>
    <comment_count>11</comment_count>
      <attachid>28961</attachid>
    <who name="Konstantin Kolinko">knst.kolinko</who>
    <bug_when>2012-06-19 12:45:58 +0000</bug_when>
    <thetext>Created attachment 28961
2012-06-19_tc6_50306_StuckThreadDetectionValve.patch

Port of StuckThreadDetectionValve to Tomcat 6

I&apos;ve also implemented the following additional features
(will apply to Tomcat 7 today, will be in 7.0.29):
- getStuckThreadNames() property, inspectable through JMX
- added thread ids to the log messages</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>160123</commentid>
    <comment_count>12</comment_count>
      <attachid>28966</attachid>
    <who name="Konstantin Kolinko">knst.kolinko</who>
    <bug_when>2012-06-20 09:06:47 +0000</bug_when>
    <thetext>Created attachment 28966
2012-06-20_tc6_50306_StuckThreadDetectionValve.patch

Updated documentation and MBean description,
aligning proposed patch with Tomcat 7.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>160399</commentid>
    <comment_count>13</comment_count>
    <who name="Konstantin Kolinko">knst.kolinko</who>
    <bug_when>2012-07-02 14:31:27 +0000</bug_when>
    <thetext>StuckThreadDetectionValve added to Tomcat 6 in r1356246 and will be in 6.0.36.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>26451</attachid>
            <date>2010-12-29 05:02:00 +0000</date>
            <delta_ts>2011-03-14 10:08:20 +0000</delta_ts>
            <desc>Patch for Tomcat&apos;s ThreadPoolExecutor</desc>
            <filename>stuck_thread_detection.patch</filename>
            <type>text/plain</type>
            <size>11313</size>
            <attacher name="TomLu">dirtchamber</attacher>
            
              <data encoding="base64">IyBUaGlzIHBhdGNoIGZpbGUgd2FzIGdlbmVyYXRlZCBieSBOZXRCZWFucyBJREUNCiMgRm9sbG93
aW5nIEluZGV4OiBwYXRocyBhcmUgcmVsYXRpdmUgdG86IEM6XEphdmFcYXBhY2hlLXRvbWNhdC03
LjAuNS1zcmNcamF2YVxvcmdcYXBhY2hlXHRvbWNhdFx1dGlsXHRocmVhZHMNCiMgVGhpcyBwYXRj
aCBjYW4gYmUgYXBwbGllZCB1c2luZyBjb250ZXh0IFRvb2xzOiBQYXRjaCBhY3Rpb24gb24gcmVz
cGVjdGl2ZSBmb2xkZXIuDQojIEl0IHVzZXMgcGxhdGZvcm0gbmV1dHJhbCBVVEYtOCBlbmNvZGlu
ZyBhbmQgXG4gbmV3bGluZXMuDQojIEFib3ZlIGxpbmVzIGFuZCB0aGlzIGxpbmUgYXJlIGlnbm9y
ZWQgYnkgdGhlIHBhdGNoaW5nIHByb2Nlc3MuDQpJbmRleDogVGhyZWFkUG9vbEV4ZWN1dG9yLmph
dmENCi0tLSBUaHJlYWRQb29sRXhlY3V0b3IuamF2YSBCYXNlIChCQVNFKQ0KKysrIFRocmVhZFBv
b2xFeGVjdXRvci5qYXZhIExvY2FsbHkgTW9kaWZpZWQgKEJhc2VkIE9uIExPQ0FMKQ0KQEAgLTE2
LDEyICsxNiwxOSBAQA0KICAqLw0KIHBhY2thZ2Ugb3JnLmFwYWNoZS50b21jYXQudXRpbC50aHJl
YWRzOw0KIA0KK2ltcG9ydCBqYXZhLnV0aWwuTGlzdDsNCitpbXBvcnQgamF2YS51dGlsLlF1ZXVl
Ow0KK2ltcG9ydCBqYXZhLnV0aWwuVGltZXI7DQoraW1wb3J0IGphdmEudXRpbC5UaW1lclRhc2s7
DQogaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkJsb2NraW5nUXVldWU7DQoraW1wb3J0IGph
dmEudXRpbC5jb25jdXJyZW50LkNvbmN1cnJlbnRIYXNoTWFwOw0KK2ltcG9ydCBqYXZhLnV0aWwu
Y29uY3VycmVudC5Db25jdXJyZW50TGlua2VkUXVldWU7DQogaW1wb3J0IGphdmEudXRpbC5jb25j
dXJyZW50LlJlamVjdGVkRXhlY3V0aW9uRXhjZXB0aW9uOw0KIGltcG9ydCBqYXZhLnV0aWwuY29u
Y3VycmVudC5SZWplY3RlZEV4ZWN1dGlvbkhhbmRsZXI7DQogaW1wb3J0IGphdmEudXRpbC5jb25j
dXJyZW50LlRocmVhZEZhY3Rvcnk7DQogaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlRpbWVV
bml0Ow0KIGltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWljSW50ZWdlcjsN
CisNCiAvKioNCiAgKiBTYW1lIGFzIGEgamF2YS51dGlsLmNvbmN1cnJlbnQuVGhyZWFkUG9vbEV4
ZWN1dG9yIGJ1dCBpbXBsZW1lbnRzIGEgbXVjaCBtb3JlIGVmZmljaWVudA0KICAqIHtAbGluayAj
Z2V0U3VibWl0dGVkQ291bnQoKX0gbWV0aG9kLCB0byBiZSB1c2VkIHRvIHByb3Blcmx5IGhhbmRs
ZSB0aGUgd29yayBxdWV1ZS4NCkBAIC0zOSwyOSArNDYsMjIwIEBADQogICAgICAqIFRoaXMgbnVt
YmVyIGlzIGFsd2F5cyBncmVhdGVyIG9yIGVxdWFsIHRvIHtAbGluayAjZ2V0QWN0aXZlQ291bnQo
KX0uDQogICAgICAqLw0KICAgICBwcml2YXRlIGZpbmFsIEF0b21pY0ludGVnZXIgc3VibWl0dGVk
Q291bnQgPSBuZXcgQXRvbWljSW50ZWdlcigwKTsNCisgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg
b3JnLmFwYWNoZS5qdWxpLmxvZ2dpbmcuTG9nIGxvZyA9IG9yZy5hcGFjaGUuanVsaS5sb2dnaW5n
LkxvZ0ZhY3RvcnkuZ2V0TG9nKG9yZy5hcGFjaGUudG9tY2F0LnV0aWwudGhyZWFkcy5UaHJlYWRQ
b29sRXhlY3V0b3IuY2xhc3MpOw0KKyAgICBwcml2YXRlIGZpbmFsIEF0b21pY0ludGVnZXIgaHVu
Z0NvdW50ID0gbmV3IEF0b21pY0ludGVnZXIoMCk7DQorICAgIHByaXZhdGUgc3RhdGljIGxvbmcg
VEhSRUFEX01PTklUT1JfVEhSRVNIT0xEX0lOX1NFQ09ORFMgPSAxMCAqIDYwOyAvL0RlZmF1bHQg
MTAgbWluLg0KKyAgICBwcml2YXRlIHN0YXRpYyBsb25nIFRIUkVBRF9NT05JVE9SX0lOVEVSVkFM
X0lOX1NFQ09ORFMgPSAxMjA7IC8vRGVmYXVsdCAxMjAgc2Vjb25kcw0KKyAgICAvL0Rvbid0IGtl
ZXAgcmVmZXJlbmNlcyB0byBhbnkgYWN0dWFsIHJ1bm5pbmcgVGhyZWFkIG9iamVjdHMsIGV4Y2Vw
dCBpbiB0aGlzIE1hcCAod2hpY2ggaXMgYXV0b21hdGljYWxseSBjbGVhbmVkIGluIGFmdGVyRXhl
Y3V0ZSgpICkuDQorICAgIC8vVGhhdCB3YXksIFRocmVhZHMgY2FuIGJlIEdDJ2VkLCBldmVudGhv
dWdoIHRoZSBNb25pdG9yIHN0aWxsIHRoaW5rcyB0aGV5IGFyZSBodW5nIChjYXVzZWQgYnkgYSBs
b25nIG1vbml0b3IgaW50ZXJ2YWwpLg0KKyAgICBwcml2YXRlIENvbmN1cnJlbnRIYXNoTWFwPFJ1
bm5hYmxlLCBNb25pdG9yZWRUaHJlYWQ+IGFjdGl2ZVRocmVhZHMgPSBudWxsOw0KKyAgICBwcml2
YXRlIFF1ZXVlPENvbXBsZXRlZEh1bmdUaHJlYWQ+IGNvbXBsZXRlZEh1bmdUaHJlYWRzUXVldWUg
PSBudWxsOw0KKyAgICBwcml2YXRlIFRpbWVyIHRpbWVyID0gbnVsbDsNCiAgICAgDQorICAgIC8v
VGhpcyBpcyBvbmx5IG1vZGlmaWVkIGluIHRoZSBzdGF0aWMgaW5pdGlhbGl6ZXIuIElmIG1vZGlm
aWVkIGVsc2V3aGVyZSwNCisgICAgLy9pdCBzaG91bGQgYmUgY2hhbmdlZCB0byB2b2xhdGlsZSBv
ciBBdG9taWMNCisgICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBtb25pdG9yaW5nRW5hYmxlZCA9
IHRydWU7IC8vRGVmYXVsdD8NCisNCisgICAgc3RhdGljIHsNCisgICAgICAgIC8vR2V0IHByb3Bl
cnRpZXMgKGlmIGNvbmZpZ3VyZWQpLCBhbmQgY2hlY2sgZm9yIHNlbnNpYmxlIHZhbHVlcw0KKw0K
KyAgICAgICAgSW50ZWdlciB0aHJlc2hvbGRUbXAgPSBJbnRlZ2VyLmdldEludGVnZXIoIm9yZy5h
cGFjaGUuY2F0YWxpbmEudGhyZWFkbW9uaXRvci50aHJlc2hvbGQiKTsgLy9JbiBzZWNvbmRzDQor
ICAgICAgICBpZiAodGhyZXNob2xkVG1wICE9IG51bGwpIHsNCisgICAgICAgICAgICBpbnQgdGhy
ZXNob2xkID0gdGhyZXNob2xkVG1wLmludFZhbHVlKCk7DQorICAgICAgICAgICAgaWYgKHRocmVz
aG9sZCA+PSA2MCkgeyAvL1NPX1RJTUVPVVQgaXMgMjAgc2VjIGluIFRvbWNhdCwgdGhlIHRocmVz
aG9sZCBtdXN0IGF0IGxlYXN0IGJlIGxhcmdlciB0aGFuIHRoYXQNCisgICAgICAgICAgICAgICAg
VEhSRUFEX01PTklUT1JfVEhSRVNIT0xEX0lOX1NFQ09ORFMgPSB0aHJlc2hvbGQ7DQorICAgICAg
ICAgICAgfQ0KKyAgICAgICAgfQ0KKw0KKyAgICAgICAgSW50ZWdlciBpbnRlcnZhbFRtcCA9IElu
dGVnZXIuZ2V0SW50ZWdlcigib3JnLmFwYWNoZS5jYXRhbGluYS50aHJlYWRtb25pdG9yLmludGVy
dmFsIik7IC8vSW4gc2Vjb25kcw0KKyAgICAgICAgaWYgKGludGVydmFsVG1wICE9IG51bGwpIHsN
CisgICAgICAgICAgICBpbnQgaW50ZXJ2YWwgPSBpbnRlcnZhbFRtcC5pbnRWYWx1ZSgpOw0KKyAg
ICAgICAgICAgIGlmIChpbnRlcnZhbCA+PSA2MCAmJiBpbnRlcnZhbCA8PSA2MDApIHsNCisgICAg
ICAgICAgICAgICAgVEhSRUFEX01PTklUT1JfSU5URVJWQUxfSU5fU0VDT05EUyA9IGludGVydmFs
Ow0KKyAgICAgICAgICAgIH0gZWxzZSBpZiAoaW50ZXJ2YWwgPD0gMCkgew0KKyAgICAgICAgICAg
ICAgICBtb25pdG9yaW5nRW5hYmxlZCA9IGZhbHNlOw0KKyAgICAgICAgICAgIH0NCisgICAgICAg
IH0NCisgICAgfQ0KKw0KICAgICBwdWJsaWMgVGhyZWFkUG9vbEV4ZWN1dG9yKGludCBjb3JlUG9v
bFNpemUsIGludCBtYXhpbXVtUG9vbFNpemUsIGxvbmcga2VlcEFsaXZlVGltZSwgVGltZVVuaXQg
dW5pdCwgQmxvY2tpbmdRdWV1ZTxSdW5uYWJsZT4gd29ya1F1ZXVlLCBSZWplY3RlZEV4ZWN1dGlv
bkhhbmRsZXIgaGFuZGxlcikgew0KICAgICAgICAgc3VwZXIoY29yZVBvb2xTaXplLCBtYXhpbXVt
UG9vbFNpemUsIGtlZXBBbGl2ZVRpbWUsIHVuaXQsIHdvcmtRdWV1ZSwgaGFuZGxlcik7DQorICAg
ICAgICBjcmVhdGVUaHJlYWRQb29sTW9uaXRvcihjb3JlUG9vbFNpemUpOw0KICAgICB9DQogDQog
ICAgIHB1YmxpYyBUaHJlYWRQb29sRXhlY3V0b3IoaW50IGNvcmVQb29sU2l6ZSwgaW50IG1heGlt
dW1Qb29sU2l6ZSwgbG9uZyBrZWVwQWxpdmVUaW1lLCBUaW1lVW5pdCB1bml0LCBCbG9ja2luZ1F1
ZXVlPFJ1bm5hYmxlPiB3b3JrUXVldWUsIFRocmVhZEZhY3RvcnkgdGhyZWFkRmFjdG9yeSwNCiAg
ICAgICAgICAgICBSZWplY3RlZEV4ZWN1dGlvbkhhbmRsZXIgaGFuZGxlcikgew0KICAgICAgICAg
c3VwZXIoY29yZVBvb2xTaXplLCBtYXhpbXVtUG9vbFNpemUsIGtlZXBBbGl2ZVRpbWUsIHVuaXQs
IHdvcmtRdWV1ZSwgdGhyZWFkRmFjdG9yeSwgaGFuZGxlcik7DQorICAgICAgICBjcmVhdGVUaHJl
YWRQb29sTW9uaXRvcihjb3JlUG9vbFNpemUpOw0KICAgICB9DQogDQogICAgIHB1YmxpYyBUaHJl
YWRQb29sRXhlY3V0b3IoaW50IGNvcmVQb29sU2l6ZSwgaW50IG1heGltdW1Qb29sU2l6ZSwgbG9u
ZyBrZWVwQWxpdmVUaW1lLCBUaW1lVW5pdCB1bml0LCBCbG9ja2luZ1F1ZXVlPFJ1bm5hYmxlPiB3
b3JrUXVldWUsIFRocmVhZEZhY3RvcnkgdGhyZWFkRmFjdG9yeSkgew0KICAgICAgICAgc3VwZXIo
Y29yZVBvb2xTaXplLCBtYXhpbXVtUG9vbFNpemUsIGtlZXBBbGl2ZVRpbWUsIHVuaXQsIHdvcmtR
dWV1ZSwgdGhyZWFkRmFjdG9yeSwgbmV3IFJlamVjdEhhbmRsZXIoKSk7DQorICAgICAgICBjcmVh
dGVUaHJlYWRQb29sTW9uaXRvcihjb3JlUG9vbFNpemUpOw0KICAgICB9DQogDQogICAgIHB1Ymxp
YyBUaHJlYWRQb29sRXhlY3V0b3IoaW50IGNvcmVQb29sU2l6ZSwgaW50IG1heGltdW1Qb29sU2l6
ZSwgbG9uZyBrZWVwQWxpdmVUaW1lLCBUaW1lVW5pdCB1bml0LCBCbG9ja2luZ1F1ZXVlPFJ1bm5h
YmxlPiB3b3JrUXVldWUpIHsNCiAgICAgICAgIHN1cGVyKGNvcmVQb29sU2l6ZSwgbWF4aW11bVBv
b2xTaXplLCBrZWVwQWxpdmVUaW1lLCB1bml0LCB3b3JrUXVldWUsIG5ldyBSZWplY3RIYW5kbGVy
KCkpOw0KKyAgICAgICAgY3JlYXRlVGhyZWFkUG9vbE1vbml0b3IoY29yZVBvb2xTaXplKTsNCiAg
ICAgfQ0KIA0KKyAgICBwcml2YXRlIHZvaWQgY3JlYXRlVGhyZWFkUG9vbE1vbml0b3IoaW50IGNv
cmVQb29sU2l6ZSkgew0KKyAgICAgICAgaWYgKG1vbml0b3JpbmdFbmFibGVkKSB7DQorICAgICAg
ICAgICAgYWN0aXZlVGhyZWFkcyA9IG5ldyBDb25jdXJyZW50SGFzaE1hcDxSdW5uYWJsZSwgTW9u
aXRvcmVkVGhyZWFkPihjb3JlUG9vbFNpemUgKiAyKTsgLy9UT0RPIGlzIGluaXRpYWxTaXplIG9r
Pw0KKyAgICAgICAgICAgIGNvbXBsZXRlZEh1bmdUaHJlYWRzUXVldWUgPSBuZXcgQ29uY3VycmVu
dExpbmtlZFF1ZXVlPENvbXBsZXRlZEh1bmdUaHJlYWQ+KCk7DQorICAgICAgICAgICAgdGltZXIg
PSBuZXcgVGltZXIoIlRocmVhZFBvb2wgbW9uaXRvciB0aW1lciIsIHRydWUpOyAvL2RhZW1vbg0K
KyAgICAgICAgICAgIE1vbml0b3JUYXNrIG1vbml0b3JUYXNrID0gbmV3IE1vbml0b3JUYXNrKCk7
DQorICAgICAgICAgICAgdGltZXIuc2NoZWR1bGUobW9uaXRvclRhc2ssIFRIUkVBRF9NT05JVE9S
X0lOVEVSVkFMX0lOX1NFQ09ORFMgKiAxMDAwLCBUSFJFQURfTU9OSVRPUl9JTlRFUlZBTF9JTl9T
RUNPTkRTICogMTAwMCk7IC8vZGVsYXksIHBlcmlvZA0KKw0KKyAgICAgICAgICAgIGxvZy5kZWJ1
ZygiTW9uaXRvcmluZyB0aHJlYWRzIHdpdGggdGhyZXNob2xkID0gIiArIFRIUkVBRF9NT05JVE9S
X1RIUkVTSE9MRF9JTl9TRUNPTkRTICsgIiBzZWMsIGludGVydmFsID0gIiArIFRIUkVBRF9NT05J
VE9SX0lOVEVSVkFMX0lOX1NFQ09ORFMgKyAiIHNlYyIpOw0KKyAgICAgICAgfQ0KKyAgICB9DQor
DQogICAgIEBPdmVycmlkZQ0KKyAgICBwcm90ZWN0ZWQgdm9pZCBiZWZvcmVFeGVjdXRlKFRocmVh
ZCB0aHJlYWQsIFJ1bm5hYmxlIHIpIHsNCisgICAgICAgIHN1cGVyLmJlZm9yZUV4ZWN1dGUodGhy
ZWFkLCByKTsNCisgICAgICAgIGlmIChtb25pdG9yaW5nRW5hYmxlZCkgew0KKyAgICAgICAgICAg
IC8vU2F2ZSB0aGUgdGhyZWFkL3J1bm5hYmxlDQorICAgICAgICAgICAgLy9LZWVwaW5nIGEgcmVm
ZXJlbmNlIHRvIHRoZSB0aHJlYWQgb2JqZWN0IGhlcmUgZG9lcyBub3QgcHJldmVudCBHQydpbmcs
DQorICAgICAgICAgICAgLy9hcyB0aGUgcmVmZXJlbmNlIGlzIHJlbW92ZWQgZnJvbSB0aGUgTWFw
IGluIGFmdGVyRXhlY3V0ZSgpDQorICAgICAgICAgICAgYWN0aXZlVGhyZWFkcy5wdXQociwgbmV3
IE1vbml0b3JlZFRocmVhZCh0aHJlYWQpKTsNCisgICAgICAgIH0NCisgICAgfQ0KKw0KKyAgICAv
Kg0KKyAgICAgKiBUaGlzIG1ldGhvZCBpcyBpbnZva2VkIGJ5IHRoZSB0aHJlYWQgdGhhdCBleGVj
dXRlZCB0aGUgdGFzaw0KKyAgICAgKi8NCisgICAgQE92ZXJyaWRlDQogICAgIHByb3RlY3RlZCB2
b2lkIGFmdGVyRXhlY3V0ZShSdW5uYWJsZSByLCBUaHJvd2FibGUgdCkgew0KKyAgICAgICAgc3Vw
ZXIuYWZ0ZXJFeGVjdXRlKHIsdCk7DQogICAgICAgICBzdWJtaXR0ZWRDb3VudC5kZWNyZW1lbnRB
bmRHZXQoKTsNCisgICAgICAgIGlmIChtb25pdG9yaW5nRW5hYmxlZCkgew0KKyAgICAgICAgICAg
IE1vbml0b3JlZFRocmVhZCBtdCA9IGFjdGl2ZVRocmVhZHMucmVtb3ZlKHIpOw0KKyAgICAgICAg
ICAgIGlmIChtdC5pc01hcmtlZEFzSHVuZygpKSB7DQorICAgICAgICAgICAgICAgIGNvbXBsZXRl
ZEh1bmdUaHJlYWRzUXVldWUuYWRkKG5ldyBDb21wbGV0ZWRIdW5nVGhyZWFkKG10LmdldFRocmVh
ZCgpLmdldE5hbWUoKSwgbXQuZ2V0QWN0aXZlVGltZUluTWlsbGlzKCkpKTsNCiAgICAgfQ0KKyAg
ICAgICAgfQ0KKyAgICB9DQogDQorICAgIGNsYXNzIE1vbml0b3JlZFRocmVhZCB7DQorDQorICAg
ICAgICAvL1dlIG5lZWQgYSByZWZlcmVuY2UgdG8gdGhlIHRocmVhZCB0byBnZXQgYSBzdGFjayB0
cmFjZSBmcm9tIHRoZSBUaW1lclRhc2sNCisgICAgICAgIHByaXZhdGUgVGhyZWFkIHRocmVhZDsN
CisgICAgICAgIHByaXZhdGUgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygp
Ow0KKyAgICAgICAgcHJpdmF0ZSB2b2xhdGlsZSBib29sZWFuIGlzSHVuZyA9IGZhbHNlOw0KKw0K
KyAgICAgICAgcHVibGljIE1vbml0b3JlZFRocmVhZChUaHJlYWQgdGhyZWFkKSB7DQorICAgICAg
ICAgICAgdGhpcy50aHJlYWQgPSB0aHJlYWQ7DQorICAgICAgICB9DQorDQorICAgICAgICBwdWJs
aWMgVGhyZWFkIGdldFRocmVhZCgpIHsNCisgICAgICAgICAgICByZXR1cm4gdGhpcy50aHJlYWQ7
DQorICAgICAgICB9DQorDQorICAgICAgICBwdWJsaWMgbG9uZyBnZXRBY3RpdmVUaW1lSW5NaWxs
aXMoKSB7DQorICAgICAgICAgICAgcmV0dXJuIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpIC0g
c3RhcnQ7DQorICAgICAgICB9DQorDQorICAgICAgICBwdWJsaWMgdm9pZCBtYXJrQXNIdW5nKCkg
ew0KKyAgICAgICAgICAgIHRoaXMuaXNIdW5nID0gdHJ1ZTsNCisgICAgICAgIH0NCisNCisgICAg
ICAgIHB1YmxpYyBib29sZWFuIGlzTWFya2VkQXNIdW5nKCkgew0KKyAgICAgICAgICAgIHJldHVy
biB0aGlzLmlzSHVuZzsNCisgICAgICAgIH0NCisgICAgfQ0KKw0KKyAgICBjbGFzcyBDb21wbGV0
ZWRIdW5nVGhyZWFkIHsNCisNCisgICAgICAgIHByaXZhdGUgU3RyaW5nIG5hbWU7DQorICAgICAg
ICBwcml2YXRlIGxvbmcgdG90YWxBY3RpdmVUaW1lOw0KKw0KKyAgICAgICAgcHVibGljIENvbXBs
ZXRlZEh1bmdUaHJlYWQoU3RyaW5nIG5hbWUsIGxvbmcgdG90YWxBY3RpdmVUaW1lKSB7DQorICAg
ICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsNCisgICAgICAgICAgICB0aGlzLnRvdGFsQWN0aXZl
VGltZSA9IHRvdGFsQWN0aXZlVGltZTsNCisgICAgICAgIH0NCisNCisgICAgICAgIHB1YmxpYyBT
dHJpbmcgZ2V0TmFtZSgpIHsNCisgICAgICAgICAgICByZXR1cm4gdGhpcy5uYW1lOw0KKyAgICAg
ICAgfQ0KKw0KKyAgICAgICAgcHVibGljIGxvbmcgZ2V0VG90YWxBY3RpdmVUaW1lKCkgew0KKyAg
ICAgICAgICAgIHJldHVybiB0aGlzLnRvdGFsQWN0aXZlVGltZTsNCisgICAgICAgIH0NCisgICAg
fQ0KKw0KKyAgICBjbGFzcyBNb25pdG9yVGFzayBleHRlbmRzIFRpbWVyVGFzayB7DQorDQorICAg
ICAgICBwdWJsaWMgTW9uaXRvclRhc2soKSB7DQorICAgICAgICB9DQorDQorICAgICAgICBAT3Zl
cnJpZGUNCisgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsNCisgICAgICAgICAgICAvL0NoZWNr
IG1vbml0b3JlZCB0aHJlYWRzDQorICAgICAgICAgICAgZm9yIChNb25pdG9yZWRUaHJlYWQgbXQg
OiBhY3RpdmVUaHJlYWRzLnZhbHVlcygpKSB7DQorICAgICAgICAgICAgICAgIGxvbmcgYWN0aXZl
VGltZSA9IG10LmdldEFjdGl2ZVRpbWVJbk1pbGxpcygpOw0KKw0KKyAgICAgICAgICAgICAgICBp
ZiAoIW10LmlzTWFya2VkQXNIdW5nKCkgJiYgYWN0aXZlVGltZSA+PSBUSFJFQURfTU9OSVRPUl9U
SFJFU0hPTERfSU5fU0VDT05EUyAqIDEwMDApIHsNCisgICAgICAgICAgICAgICAgICAgIGludCBu
dW1IdW5nVGhyZWFkcyA9IGh1bmdDb3VudC5pbmNyZW1lbnRBbmRHZXQoKTsNCisgICAgICAgICAg
ICAgICAgICAgIG10Lm1hcmtBc0h1bmcoKTsNCisgICAgICAgICAgICAgICAgICAgIG5vdGlmeUh1
bmdUaHJlYWREZXRlY3RlZChtdC5nZXRUaHJlYWQoKS5nZXROYW1lKCksIG10LmdldFRocmVhZCgp
LmdldFN0YWNrVHJhY2UoKSwgYWN0aXZlVGltZSwgbnVtSHVuZ1RocmVhZHMpOw0KKyAgICAgICAg
ICAgICAgICB9DQorICAgICAgICAgICAgfQ0KKyAgICAgICAgICAgIC8vQ2hlY2sgaWYgYW55IHRo
cmVhZHMgcHJldmlvdXNseSByZXBvcnRlZCBhcyBodW5nLCBoYXZlIGZpbmlzaGVkLg0KKyAgICAg
ICAgICAgIENvbXBsZXRlZEh1bmdUaHJlYWQgY2h0ID0gY29tcGxldGVkSHVuZ1RocmVhZHNRdWV1
ZS5wb2xsKCk7DQorICAgICAgICAgICAgd2hpbGUgKGNodCAhPSBudWxsKSB7DQorICAgICAgICAg
ICAgICAgIGludCBudW1IdW5nVGhyZWFkcyA9IGh1bmdDb3VudC5kZWNyZW1lbnRBbmRHZXQoKTsN
CisgICAgICAgICAgICAgICAgbm90aWZ5SHVuZ1RocmVhZENvbXBsZXRlZChjaHQuZ2V0TmFtZSgp
LCBjaHQuZ2V0VG90YWxBY3RpdmVUaW1lKCksIG51bUh1bmdUaHJlYWRzKTsNCisgICAgICAgICAg
ICAgICAgY2h0ID0gY29tcGxldGVkSHVuZ1RocmVhZHNRdWV1ZS5wb2xsKCk7DQorICAgICAgICAg
ICAgfQ0KKyAgICAgICAgfQ0KKyAgICB9DQorDQorICAgIC8vVGhlIGZvbGxvd2luZyBtZXRob2Rz
IGNvdWxkIGJlIGltcGxlbWVudGVkIHVzaW5nIGEgTGlzdGVuZXIgaW5zdGVhZDoNCisgICAgLy9I
dW5nVGhyZWFkTGlzdGVuZXINCisgICAgLy8ib25IdW5nVGhyZWFkRGV0ZWN0ZWQiDQorICAgIC8v
Im9uSHVuZ1RocmVhZENvbXBsZXRlZCINCisgICAgcHJpdmF0ZSB2b2lkIG5vdGlmeUh1bmdUaHJl
YWREZXRlY3RlZChTdHJpbmcgdGhyZWFkTmFtZSwgU3RhY2tUcmFjZUVsZW1lbnRbXSB0cmFjZSwg
bG9uZyBhY3RpdmVUaW1lLCBpbnQgbnVtSHVuZ1RocmVhZHMpIHsNCisgICAgICAgIC8vVE9ETyBB
ZGQgSk1YIG5vdGlmaWNhdGlvbiA/DQorICAgICAgICBTdHJpbmcgaGVhZGVyID0gIlRocmVhZCBc
IiIgKyB0aHJlYWROYW1lICsgIlwiIGhhcyBiZWVuIGFjdGl2ZSBmb3IgIiArIGFjdGl2ZVRpbWUg
KyAiIG1pbGxpc2Vjb25kcyBhbmQgbWF5IGJlIGh1bmcuIFRoZXJlIGlzL2FyZSAiICsgbnVtSHVu
Z1RocmVhZHMgKyAiIHRocmVhZChzKSBpbiB0b3RhbCBpbiB0aGlzIHRocmVhZCBwb29sIHRoYXQg
bWF5IGJlIGh1bmcuIjsNCisgICAgICAgIGhlYWRlciArPSAiXG4iICsgZ2V0U3RhY2tUcmFjZUFz
U3RyaW5nKHRyYWNlKTsNCisgICAgICAgIGxvZy53YXJuKGhlYWRlcik7DQorICAgIH0NCisNCisg
ICAgcHJpdmF0ZSB2b2lkIG5vdGlmeUh1bmdUaHJlYWRDb21wbGV0ZWQoU3RyaW5nIHRocmVhZE5h
bWUsIGxvbmcgYWN0aXZlVGltZSwgaW50IG51bUh1bmdUaHJlYWRzKSB7DQorICAgICAgICAvL1RP
RE8gQWRkIEpNWCBub3RpZmljYXRpb24gPw0KKyAgICAgICAgU3RyaW5nIG1zZyA9ICJUaHJlYWQg
XCIiICsgdGhyZWFkTmFtZSArICJcIiB3YXMgcHJldmlvdXNseSByZXBvcnRlZCB0byBiZSBodW5n
IGJ1dCBoYXMgY29tcGxldGVkLiBJdCB3YXMgYWN0aXZlIGZvciBhcHByb3hpbWF0ZWx5ICIgKyBh
Y3RpdmVUaW1lICsgIiBtaWxsaXNlY29uZHMuIFRoZXJlIGlzL2FyZSAiICsgbnVtSHVuZ1RocmVh
ZHMgKyAiIHRocmVhZChzKSBpbiB0b3RhbCBpbiB0aGUgc2VydmVyIHRoYXQgc3RpbGwgbWF5IGJl
IGh1bmcuIjsNCisgICAgICAgIGxvZy53YXJuKG1zZyk7IC8vU2luY2UgdGhlICJodW5nIHRocmVh
ZCBub3RpZmljYXRpb24iIGlzIHdhcm4sIHRoaXMgc2hvdWxkIGFsc28gYmUgd2Fybg0KKyAgICB9
DQorDQorICAgIC8vVE9ETyBVdGlsaXR5IG1ldGhvZCwgc2hvdWxkIGJlIG1vdmVkIHRvIHV0aWxp
dHkgY2xhc3MNCisgICAgcHVibGljIHN0YXRpYyBTdHJpbmcgZ2V0U3RhY2tUcmFjZUFzU3RyaW5n
KFN0YWNrVHJhY2VFbGVtZW50W10gdHJhY2UpIHsNCisgICAgICAgIFN0cmluZ0J1aWxkZXIgYnVm
ID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsNCisgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdHJh
Y2UubGVuZ3RoOyBpKyspIHsNCisgICAgICAgICAgICBidWYuYXBwZW5kKCJcdGF0ICIpLmFwcGVu
ZCh0cmFjZVtpXSkuYXBwZW5kKCJcbiIpOw0KKyAgICAgICAgfQ0KKyAgICAgICAgcmV0dXJuIGJ1
Zi50b1N0cmluZygpOw0KKyAgICB9DQorDQorICAgIHB1YmxpYyB2b2lkIHNodXRkb3duTW9uaXRv
clRpbWVyKCl7DQorICAgICAgICBpZih0aW1lciAhPSBudWxsKXsNCisgICAgICAgICAgICB0aW1l
ci5jYW5jZWwoKTsNCisgICAgICAgIH0NCisgICAgfQ0KKw0KKyAgICBAT3ZlcnJpZGUNCisgICAg
cHVibGljIHZvaWQgc2h1dGRvd24oKXsNCisgICAgICAgIHN1cGVyLnNodXRkb3duKCk7DQorICAg
ICAgICBzaHV0ZG93bk1vbml0b3JUaW1lcigpOw0KKyAgICB9DQorDQorICAgIEBPdmVycmlkZQ0K
KyAgICBwdWJsaWMgTGlzdDxSdW5uYWJsZT4gc2h1dGRvd25Ob3coKXsNCisgICAgICAgIExpc3Q8
UnVubmFibGU+IHJ1bm5hYmxlcyA9IHN1cGVyLnNodXRkb3duTm93KCk7DQorICAgICAgICBzaHV0
ZG93bk1vbml0b3JUaW1lcigpOw0KKyAgICAgICAgcmV0dXJuIHJ1bm5hYmxlczsNCisgICAgfQ0K
Kw0KICAgICBwdWJsaWMgaW50IGdldFN1Ym1pdHRlZENvdW50KCkgew0KICAgICAgICAgcmV0dXJu
IHN1Ym1pdHRlZENvdW50LmdldCgpOw0KICAgICB9DQpAQCAtNzEsNyArMjY5LDcgQEANCiAgICAg
ICovDQogICAgIEBPdmVycmlkZQ0KICAgICBwdWJsaWMgdm9pZCBleGVjdXRlKFJ1bm5hYmxlIGNv
bW1hbmQpIHsNCi0gICAgICAgIGV4ZWN1dGUoY29tbWFuZCwwLFRpbWVVbml0Lk1JTExJU0VDT05E
Uyk7DQorICAgICAgICBleGVjdXRlKGNvbW1hbmQsIDAsIFRpbWVVbml0Lk1JTExJU0VDT05EUyk7
DQogICAgIH0NCiAgICAgDQogICAgIC8qKg0K
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>26769</attachid>
            <date>2011-03-14 10:30:00 +0000</date>
            <delta_ts>2011-03-14 10:30:23 +0000</delta_ts>
            <desc>New Valve: StuckThreadDetectionValve</desc>
            <filename>stuckthreadvalve.patch</filename>
            <type>text/plain</type>
            <size>12554</size>
            <attacher name="TomLu">dirtchamber</attacher>
            
              <data encoding="base64">IyBUaGlzIHBhdGNoIGNhbiBiZSBhcHBsaWVkIHVzaW5nIGNvbnRleHQgVG9vbHM6IFBhdGNoIGFj
dGlvbiBvbiByZXNwZWN0aXZlIGZvbGRlci4NCiMgSXQgdXNlcyBwbGF0Zm9ybSBuZXV0cmFsIFVU
Ri04IGVuY29kaW5nIGFuZCBcbiBuZXdsaW5lcy4NCiMgQWJvdmUgbGluZXMgYW5kIHRoaXMgbGlu
ZSBhcmUgaWdub3JlZCBieSB0aGUgcGF0Y2hpbmcgcHJvY2Vzcy4NCkluZGV4OiBqYXZhL29yZy9h
cGFjaGUvY2F0YWxpbmEvdmFsdmVzL0xvY2FsU3RyaW5ncy5wcm9wZXJ0aWVzDQotLS0gamF2YS9v
cmcvYXBhY2hlL2NhdGFsaW5hL3ZhbHZlcy9Mb2NhbFN0cmluZ3MucHJvcGVydGllcyBCYXNlIChC
QVNFKQ0KKysrIGphdmEvb3JnL2FwYWNoZS9jYXRhbGluYS92YWx2ZXMvTG9jYWxTdHJpbmdzLnBy
b3BlcnRpZXMgTG9jYWxseSBNb2RpZmllZCAoQmFzZWQgT24gTE9DQUwpDQpAQCAtNDEsNiArNDEs
MTAgQEANCiAjIFJlbW90ZSBJUCB2YWx2ZQ0KIHJlbW90ZUlwVmFsdmUuc3ludGF4PUludmFsaWQg
cmVndWxhciBleHByZXNzaW9ucyBbezB9XSBwcm92aWRlZC4NCiANCisjU3R1Y2sgdGhyZWFkIGRl
dGVjdGlvbiBWYWx2ZQ0KK3N0dWNrVGhyZWFkRGV0ZWN0aW9uVmFsdmUubm90aWZ5U3R1Y2tUaHJl
YWREZXRlY3RlZD1UaHJlYWQgInswfSIgaGFzIGJlZW4gYWN0aXZlIGZvciB7MX0gbWlsbGlzZWNv
bmRzIChzdGFydGVkIHsyfSkgYW5kIG1heSBiZSBzdHVjay4gVGhlcmUgaXMvYXJlIHszfSB0aHJl
YWQocykgaW4gdG90YWwgdGhhdCBhcmUgbW9uaXRvcmVkIGJ5IHRoaXMgVmFsdmUgYW5kIG1heSBi
ZSBzdHVjay4NCitzdHVja1RocmVhZERldGVjdGlvblZhbHZlLm5vdGlmeVN0dWNrVGhyZWFkQ29t
cGxldGVkPVRocmVhZCAiezB9IiB3YXMgcHJldmlvdXNseSByZXBvcnRlZCB0byBiZSBzdHVjayBi
dXQgaGFzIGNvbXBsZXRlZC4gSXQgd2FzIGFjdGl2ZSBmb3IgYXBwcm94aW1hdGVseSB7MX0gbWls
bGlzZWNvbmRzLiBUaGVyZSBpcy9hcmUgezJ9IHRocmVhZChzKSBpbiB0b3RhbCB0aGF0IGFyZSBt
b25pdG9yZWQgYnkgdGhpcyBWYWx2ZSBhbmQgc3RpbGwgbWF5IGJlIHN0dWNrLg0KKw0KICMgSFRU
UCBzdGF0dXMgcmVwb3J0cw0KIGh0dHAuMTAwPVRoZSBjbGllbnQgbWF5IGNvbnRpbnVlICh7MH0p
Lg0KIGh0dHAuMTAxPVRoZSBzZXJ2ZXIgaXMgc3dpdGNoaW5nIHByb3RvY29scyBhY2NvcmRpbmcg
dG8gdGhlICJVcGdyYWRlIiBoZWFkZXIgKHswfSkuDQpJbmRleDogamF2YS9vcmcvYXBhY2hlL2Nh
dGFsaW5hL3ZhbHZlcy9TdHVja1RocmVhZERldGVjdGlvblZhbHZlLmphdmENCi0tLSBqYXZhL29y
Zy9hcGFjaGUvY2F0YWxpbmEvdmFsdmVzL1N0dWNrVGhyZWFkRGV0ZWN0aW9uVmFsdmUuamF2YSBM
b2NhbGx5IE5ldw0KKysrIGphdmEvb3JnL2FwYWNoZS9jYXRhbGluYS92YWx2ZXMvU3R1Y2tUaHJl
YWREZXRlY3Rpb25WYWx2ZS5qYXZhIExvY2FsbHkgTmV3DQpAQCAtMCwwICsxLDMwMCBAQA0KKy8q
DQorICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVu
ZGVyIG9uZSBvciBtb3JlDQorICogY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2Vl
IHRoZSBOT1RJQ0UgZmlsZSBkaXN0cmlidXRlZCB3aXRoDQorICogdGhpcyB3b3JrIGZvciBhZGRp
dGlvbmFsIGluZm9ybWF0aW9uIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLg0KKyAqIFRo
ZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlIHRvIFlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2Us
IFZlcnNpb24gMi4wDQorICogKHRoZSAiTGljZW5zZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBm
aWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGgNCisgKiB0aGUgTGljZW5zZS4gIFlvdSBtYXkg
b2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KKyAqDQorICogICAgICBodHRwOi8vd3d3
LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCisgKg0KKyAqIFVubGVzcyByZXF1aXJl
ZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCisg
KiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMg
SVMiIEJBU0lTLA0KKyAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBL
SU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KKyAqIFNlZSB0aGUgTGljZW5zZSBmb3Ig
dGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCisgKiBsaW1p
dGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCisgKi8NCitwYWNrYWdlIG9yZy5hcGFjaGUuY2F0
YWxpbmEudmFsdmVzOw0KKw0KK2ltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOw0KK2ltcG9ydCBq
YXZhLnV0aWwuRGF0ZTsNCitpbXBvcnQgamF2YS51dGlsLlF1ZXVlOw0KK2ltcG9ydCBqYXZhLnV0
aWwuY29uY3VycmVudC5Db25jdXJyZW50SGFzaE1hcDsNCitpbXBvcnQgamF2YS51dGlsLmNvbmN1
cnJlbnQuQ29uY3VycmVudExpbmtlZFF1ZXVlOw0KK2ltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu
dC5hdG9taWMuQXRvbWljSW50ZWdlcjsNCisNCitpbXBvcnQgamF2YXguc2VydmxldC5TZXJ2bGV0
RXhjZXB0aW9uOw0KK2ltcG9ydCBvcmcuYXBhY2hlLmNhdGFsaW5hLkNvbnRhaW5lcjsNCitpbXBv
cnQgb3JnLmFwYWNoZS5jYXRhbGluYS5FbmdpbmU7DQoraW1wb3J0IG9yZy5hcGFjaGUuY2F0YWxp
bmEuTGlmZWN5Y2xlRXhjZXB0aW9uOw0KKw0KK2ltcG9ydCBvcmcuYXBhY2hlLmNhdGFsaW5hLmNv
bm5lY3Rvci5SZXF1ZXN0Ow0KK2ltcG9ydCBvcmcuYXBhY2hlLmNhdGFsaW5hLmNvbm5lY3Rvci5S
ZXNwb25zZTsNCitpbXBvcnQgb3JnLmFwYWNoZS5qdWxpLmxvZ2dpbmcuTG9nOw0KK2ltcG9ydCBv
cmcuYXBhY2hlLmp1bGkubG9nZ2luZy5Mb2dGYWN0b3J5Ow0KK2ltcG9ydCBvcmcuYXBhY2hlLnRv
bWNhdC51dGlsLnJlcy5TdHJpbmdNYW5hZ2VyOw0KKw0KK3B1YmxpYyBjbGFzcyBTdHVja1RocmVh
ZERldGVjdGlvblZhbHZlIGV4dGVuZHMgVmFsdmVCYXNlIHsNCisNCisgICAgLyoqDQorICAgICAq
IFRoZSBkZXNjcmlwdGl2ZSBpbmZvcm1hdGlvbiByZWxhdGVkIHRvIHRoaXMgaW1wbGVtZW50YXRp
b24uDQorICAgICAqLw0KKyAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgaW5mbyA9DQor
ICAgICAgICAgICAgIm9yZy5hcGFjaGUuY2F0YWxpbmEudmFsdmVzLlN0dWNrVGhyZWFkRGV0ZWN0
aW9uVmFsdmUvMS4wIjsNCisgICAgLyoqDQorICAgICAqIExvZ2dlcg0KKyAgICAgKi8NCisgICAg
cHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nIGxvZyA9IExvZ0ZhY3RvcnkuZ2V0TG9nKFN0dWNrVGhy
ZWFkRGV0ZWN0aW9uVmFsdmUuY2xhc3MpOw0KKyAgICAvKioNCisgICAgICogS2VlcHMgY291bnQg
b2YgdGhlIG51bWJlciBvZiBzdHVjayB0aHJlYWRzIGRldGVjdGVkDQorICAgICAqLw0KKyAgICBw
cml2YXRlIGZpbmFsIEF0b21pY0ludGVnZXIgc3R1Y2tDb3VudCA9IG5ldyBBdG9taWNJbnRlZ2Vy
KDApOw0KKyAgICAvKioNCisgICAgICogSW4gc2Vjb25kcy4gRGVmYXVsdCA2MDAgKDEwIG1pbnV0
ZXMpLg0KKyAgICAgKi8NCisgICAgcHJpdmF0ZSBpbnQgdGhyZXNob2xkID0gNjAwOw0KKyAgICAv
KioNCisgICAgICogJ1NPX1RJTUVPVVQnIGlzIDIwIHNlY29uZHMgaW4gVG9tY2F0Lg0KKyAgICAg
KiBUaGUgdGhyZXNob2xkIG11c3QgYXQgbGVhc3QgYmUgbGFyZ2VyIHRoYW4gdGhhdC4NCisgICAg
ICovDQorICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBUSFJFU0hPTERfTUlOX1ZBTFVFID0g
MTIwOw0KKyAgICAvKioNCisgICAgICogVGhlIG9ubHkgcmVmZXJlbmNlcyB3ZSBrZWVwIHRvIGFj
dHVhbCBydW5uaW5nIFRocmVhZCBvYmplY3RzIGFyZSBpbg0KKyAgICAgKiB0aGlzIE1hcCAod2hp
Y2ggaXMgYXV0b21hdGljYWxseSBjbGVhbmVkIGluIGludm9rZSgpcyBmaW5hbGx5IGNsYXVzZSku
DQorICAgICAqIFRoYXQgd2F5LCBUaHJlYWRzIGNhbiBiZSBHQydlZCwgZXZlbnRob3VnaCB0aGUg
VmFsdmUgc3RpbGwgdGhpbmtzIHRoZXkNCisgICAgICogYXJlIHN0dWNrIChjYXVzZWQgYnkgYSBs
b25nIG1vbml0b3IgaW50ZXJ2YWwpDQorICAgICAqLw0KKyAgICBwcml2YXRlIENvbmN1cnJlbnRI
YXNoTWFwPExvbmcsIE1vbml0b3JlZFRocmVhZD4gYWN0aXZlVGhyZWFkcyA9DQorICAgICAgICAg
ICAgbmV3IENvbmN1cnJlbnRIYXNoTWFwPExvbmcsIE1vbml0b3JlZFRocmVhZD4oKTsNCisgICAg
LyoqDQorICAgICAqDQorICAgICAqLw0KKyAgICBwcml2YXRlIFF1ZXVlPENvbXBsZXRlZFN0dWNr
VGhyZWFkPiBjb21wbGV0ZWRTdHVja1RocmVhZHNRdWV1ZSA9DQorICAgICAgICAgICAgbmV3IENv
bmN1cnJlbnRMaW5rZWRRdWV1ZTxDb21wbGV0ZWRTdHVja1RocmVhZD4oKTsNCisgICAgLyoqDQor
ICAgICAqIFRoZSBzdHJpbmcgbWFuYWdlciBmb3IgdGhpcyBwYWNrYWdlLg0KKyAgICAgKi8NCisg
ICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nTWFuYWdlciBzbSA9DQorICAgICAgICAgICAg
U3RyaW5nTWFuYWdlci5nZXRNYW5hZ2VyKENvbnN0YW50cy5QYWNrYWdlKTsNCisNCisgICAgLyoq
DQorICAgICAqIFNwZWNpZnkgdGhlIHRocmVzaG9sZCAoaW4gc2Vjb25kcykgdXNlZCB3aGVuIGNo
ZWNraW5nIGZvciBzdHVjayB0aHJlYWRzLg0KKyAgICAgKiBNaW5pbXVtIHZhbHVlIGlzIDEyMCBz
ZWNvbmRzLiBUaGUgZGVmYXVsdCBpcyA2MDAgc2Vjb25kcy4NCisgICAgICoNCisgICAgICogQHBh
cmFtIHRocmVzaG9sZCAgIFRoZSBuZXcgdGhyZXNob2xkIGluIHNlY29uZHMNCisgICAgICovDQor
ICAgIHB1YmxpYyB2b2lkIHNldFRocmVzaG9sZChpbnQgdGhyZXNob2xkKSB7DQorICAgICAgICBp
ZiAodGhyZXNob2xkID49IFRIUkVTSE9MRF9NSU5fVkFMVUUpIHsNCisgICAgICAgICAgICB0aGlz
LnRocmVzaG9sZCA9IHRocmVzaG9sZDsNCisgICAgICAgICAgICBpZiAobG9nLmlzRGVidWdFbmFi
bGVkKCkpIHsNCisgICAgICAgICAgICAgICAgbG9nLmRlYnVnKCJUaHJlc2hvbGQgc2V0IHRvICIg
KyB0aHJlc2hvbGQgKyAiIHNlY29uZHMiKTsNCisgICAgICAgICAgICB9DQorICAgICAgICB9IGVs
c2Ugew0KKyAgICAgICAgICAgIGxvZy53YXJuKCJUaHJlc2hvbGQgdG9vIGxvdy4gTXVzdCBiZSAi
DQorICAgICAgICAgICAgICAgICAgICArIFRIUkVTSE9MRF9NSU5fVkFMVUUNCisgICAgICAgICAg
ICAgICAgICAgICsgIiBvciBsYXJnZXIuIEFjdHVhbDogIiArIHRocmVzaG9sZCk7DQorICAgICAg
ICB9DQorICAgIH0NCisNCisgICAgLyoqDQorICAgICAqIEBzZWUgI3NldFRocmVzaG9sZChpbnQp
DQorICAgICAqIEByZXR1cm4gIFRoZSBjdXJyZW50IHRocmVzaG9sZCBpbiBzZWNvbmRzDQorICAg
ICAqLw0KKyAgICBwdWJsaWMgaW50IGdldFRocmVzaG9sZCgpIHsNCisgICAgICAgIHJldHVybiB0
aHJlc2hvbGQ7DQorICAgIH0NCisNCisgICAgQE92ZXJyaWRlDQorICAgIHByb3RlY3RlZCB2b2lk
IGluaXRJbnRlcm5hbCgpIHRocm93cyBMaWZlY3ljbGVFeGNlcHRpb24gew0KKyAgICAgICAgc3Vw
ZXIuaW5pdEludGVybmFsKCk7DQorDQorICAgICAgICBpZiAobG9nLmlzRGVidWdFbmFibGVkKCkp
IHsNCisgICAgICAgICAgICBsb2cuZGVidWcoIk1vbml0b3Jpbmcgc3R1Y2sgdGhyZWFkcyB3aXRo
IHRocmVzaG9sZCA9ICINCisgICAgICAgICAgICAgICAgICAgICsgdGhyZXNob2xkDQorICAgICAg
ICAgICAgICAgICAgICArICIgc2VjIik7DQorICAgICAgICB9DQorICAgIH0NCisNCisgICAgLyoq
DQorICAgICAqIFJldHVybiBkZXNjcmlwdGl2ZSBpbmZvcm1hdGlvbiBhYm91dCB0aGlzIFZhbHZl
IGltcGxlbWVudGF0aW9uLg0KKyAgICAgKi8NCisgICAgQE92ZXJyaWRlDQorICAgIHB1YmxpYyBT
dHJpbmcgZ2V0SW5mbygpIHsNCisgICAgICAgIHJldHVybiBpbmZvOw0KKyAgICB9DQorDQorICAg
IHByaXZhdGUgdm9pZCBub3RpZnlTdHVja1RocmVhZERldGVjdGVkKFN0cmluZyB0aHJlYWROYW1l
LA0KKyAgICAgICAgICAgIFN0YWNrVHJhY2VFbGVtZW50W10gdHJhY2UsIGxvbmcgYWN0aXZlVGlt
ZSwNCisgICAgICAgICAgICBEYXRlIHN0YXJ0VGltZSwgaW50IG51bVN0dWNrVGhyZWFkcykgew0K
Kw0KKyAgICAgICAgU3RyaW5nIG1zZyA9IHNtLmdldFN0cmluZygNCisgICAgICAgICAgICAgICAg
InN0dWNrVGhyZWFkRGV0ZWN0aW9uVmFsdmUubm90aWZ5U3R1Y2tUaHJlYWREZXRlY3RlZCIsDQor
ICAgICAgICAgICAgICAgIHRocmVhZE5hbWUsIGFjdGl2ZVRpbWUsIHN0YXJ0VGltZSwgbnVtU3R1
Y2tUaHJlYWRzKTsNCisgICAgICAgIG1zZyArPSAiXG4iICsgZ2V0U3RhY2tUcmFjZUFzU3RyaW5n
KHRyYWNlKTsNCisgICAgICAgIGxvZy53YXJuKG1zZyk7DQorICAgIH0NCisNCisgICAgcHJpdmF0
ZSB2b2lkIG5vdGlmeVN0dWNrVGhyZWFkQ29tcGxldGVkKFN0cmluZyB0aHJlYWROYW1lLA0KKyAg
ICAgICAgICAgIGxvbmcgYWN0aXZlVGltZSwgaW50IG51bVN0dWNrVGhyZWFkcykgew0KKw0KKyAg
ICAgICAgU3RyaW5nIG1zZyA9IHNtLmdldFN0cmluZygNCisgICAgICAgICAgICAgICAgInN0dWNr
VGhyZWFkRGV0ZWN0aW9uVmFsdmUubm90aWZ5U3R1Y2tUaHJlYWRDb21wbGV0ZWQiLA0KKyAgICAg
ICAgICAgICAgICB0aHJlYWROYW1lLCBhY3RpdmVUaW1lLCBudW1TdHVja1RocmVhZHMpOw0KKyAg
ICAgICAgLy9TaW5jZSB0aGUgInN0dWNrIHRocmVhZCBub3RpZmljYXRpb24iIGlzIHdhcm4sIHRo
aXMgc2hvdWxkIGFsc28gYmUgd2Fybg0KKyAgICAgICAgbG9nLndhcm4obXNnKTsNCisgICAgfQ0K
Kw0KKyAgICAvL1RPRE8gVXRpbGl0eSBtZXRob2QsIHNob3VsZCBiZSBtb3ZlZCB0byB1dGlsaXR5
IGNsYXNzDQorICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5nIGdldFN0YWNrVHJhY2VBc1N0cmluZyhT
dGFja1RyYWNlRWxlbWVudFtdIHRyYWNlKSB7DQorICAgICAgICBTdHJpbmdCdWlsZGVyIGJ1ZiA9
IG5ldyBTdHJpbmdCdWlsZGVyKCk7DQorICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHRyYWNl
Lmxlbmd0aDsgaSsrKSB7DQorICAgICAgICAgICAgYnVmLmFwcGVuZCgiXHRhdCAiKS5hcHBlbmQo
dHJhY2VbaV0pLmFwcGVuZCgiXG4iKTsNCisgICAgICAgIH0NCisgICAgICAgIHJldHVybiBidWYu
dG9TdHJpbmcoKTsNCisgICAgfQ0KKw0KKyAgICAvL0ZJWE1FIHdoZXJlIGRvZXMgaXQgbWFrZSBz
ZW5zZSB0byBhZGQgdGhpcyBWYWx2ZT8NCisgICAgLyoqDQorICAgICAqIFNldCB0aGUgQ29udGFp
bmVyIHRvIHdoaWNoIHRoaXMgVmFsdmUgaXMgYXR0YWNoZWQuDQorICAgICAqDQorICAgICAqIEBw
YXJhbSBjb250YWluZXIgVGhlIGNvbnRhaW5lciB0byB3aGljaCB3ZSBhcmUgYXR0YWNoZWQNCisg
ICAgICovDQorICAgIEBPdmVycmlkZQ0KKyAgICBwdWJsaWMgdm9pZCBzZXRDb250YWluZXIoQ29u
dGFpbmVyIGNvbnRhaW5lcikgew0KKw0KKyAgICAgICAgaWYgKGNvbnRhaW5lciA9PSBudWxsKXsN
CisgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJDb25maWd1
cmF0aW9uIGVycm9yOiAgIg0KKyAgICAgICAgICAgICAgICAgICAgKyAiQ29udGFpbmVyIGNhbm5v
dCBiZSBudWxsLiBWYWx2ZSBtdXN0IGJlIGF0dGFjaGVkIHRvIGFuIEVuZ2luZSIpOw0KKyAgICAg
ICAgfQ0KKyAgICAgICAgaWYoIShjb250YWluZXIgaW5zdGFuY2VvZiBFbmdpbmUpKXsNCisgICAg
ICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJDb25maWd1cmF0aW9u
IGVycm9yOiAgIg0KKyAgICAgICAgICAgICAgICAgICAgKyAiVmFsdmUgbXVzdCBiZSBhdHRhY2hl
ZCB0byBhbiBFbmdpbmUuIEFjdHVhbDogIg0KKyAgICAgICAgICAgICAgICAgICAgK2NvbnRhaW5l
ci5nZXRDbGFzcygpLmdldE5hbWUoKSk7DQorICAgICAgICB9DQorDQorICAgICAgICBzdXBlci5z
ZXRDb250YWluZXIoY29udGFpbmVyKTsNCisvLyAgICAgICAgdGhpcy5lbmdpbmUgPSAoRW5naW5l
KSBjb250YWluZXI7DQorICAgIH0NCisNCisgICAgLyoqDQorICAgICAqIHtAaW5oZXJpdERvY30N
CisgICAgICovDQorICAgIEBPdmVycmlkZQ0KKyAgICBwdWJsaWMgdm9pZCBpbnZva2UoUmVxdWVz
dCByZXF1ZXN0LCBSZXNwb25zZSByZXNwb25zZSkNCisgICAgICAgICAgICB0aHJvd3MgSU9FeGNl
cHRpb24sIFNlcnZsZXRFeGNlcHRpb24gew0KKyAgICAgICAgLy9TYXZlIHRoZSB0aHJlYWQvcnVu
bmFibGUNCisgICAgICAgIC8vS2VlcGluZyBhIHJlZmVyZW5jZSB0byB0aGUgdGhyZWFkIG9iamVj
dCBoZXJlIGRvZXMgbm90IHByZXZlbnQgR0MnaW5nLA0KKyAgICAgICAgLy9hcyB0aGUgcmVmZXJl
bmNlIGlzIHJlbW92ZWQgZnJvbSB0aGUgTWFwIGluIHRoZSBmaW5hbGx5IGNsYXVzZQ0KKw0KKyAg
ICAgICAgTG9uZyBrZXkgPSBuZXcgTG9uZyhUaHJlYWQuY3VycmVudFRocmVhZCgpLmdldElkKCkp
Ow0KKw0KKyAgICAgICAgTW9uaXRvcmVkVGhyZWFkIHByZXZpb3VzID0gYWN0aXZlVGhyZWFkcy5w
dXQoa2V5LA0KKyAgICAgICAgICAgICAgICBuZXcgTW9uaXRvcmVkVGhyZWFkKFRocmVhZC5jdXJy
ZW50VGhyZWFkKCkpKTsNCisNCisgICAgICAgIC8vSW4gdGhlb3J5IHdlIG1pZ2h0IGdldCBjb2xs
aXNpb25zIHdoZW4gdXNpbmcgIm5ldyBMb25nKHRocmVhZC5nZXRJZCgpKS5oYXNoQ29kZSgpIi4N
CisgICAgICAgIC8vV2UgY2FuIHByZXZlbnQgdGhpcyBieSB1c2luZyBuZXcgSW50ZWdlcihBdG9t
aWNJbnQuZ2V0QW5kSW5jcmVtZW50KCkpIGZvciB1bmlxdWVuZXNzDQorICAgICAgICBpZiAocHJl
dmlvdXMgIT0gbnVsbCkgew0KKyAgICAgICAgICAgIGxvZy5lcnJvcigiS2V5IGFscmVhZHkgYWRk
ZWQgdG8gbWFwLiBQcmV2aW91cyB2YWx1ZSBoYXMgYmVlbiByZW1vdmVkICgiDQorICAgICAgICAg
ICAgICAgICAgICArIHByZXZpb3VzLmdldFRocmVhZCgpLmdldE5hbWUoKSArICIpIik7DQorICAg
ICAgICB9DQorDQorICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpIHsNCisgICAgICAg
ICAgICBsb2cudHJhY2UoIk1vbml0b3JpbmcgZXhlY3V0aW9uIHRpbWUgZm9yIFJlcXVlc3QgIg0K
KyAgICAgICAgICAgICAgICAgICAgKyByZXF1ZXN0LmdldFJlcXVlc3RVUkkoKSArICIgd2l0aCBv
cmlnaW5hbFJlbW90ZUFkZHIgJyINCisgICAgICAgICAgICAgICAgICAgICsgcmVxdWVzdC5nZXRS
ZW1vdGVBZGRyKCkgKyAiOiIgKyByZXF1ZXN0LmdldFJlbW90ZVBvcnQoKQ0KKyAgICAgICAgICAg
ICAgICAgICAgKyAiJyIpOw0KKyAgICAgICAgfQ0KKw0KKyAgICAgICAgdHJ5IHsNCisgICAgICAg
ICAgICBnZXROZXh0KCkuaW52b2tlKHJlcXVlc3QsIHJlc3BvbnNlKTsNCisgICAgICAgIH0gZmlu
YWxseSB7DQorICAgICAgICAgICAgTW9uaXRvcmVkVGhyZWFkIG1vbml0b3JlZFRocmVhZCA9IGFj
dGl2ZVRocmVhZHMucmVtb3ZlKGtleSk7DQorICAgICAgICAgICAgaWYgKG1vbml0b3JlZFRocmVh
ZC5pc01hcmtlZEFzU3R1Y2soKSkgew0KKyAgICAgICAgICAgICAgICBjb21wbGV0ZWRTdHVja1Ro
cmVhZHNRdWV1ZS5hZGQoDQorICAgICAgICAgICAgICAgICAgICAgICAgbmV3IENvbXBsZXRlZFN0
dWNrVGhyZWFkKG1vbml0b3JlZFRocmVhZC5nZXRUaHJlYWQoKS5nZXROYW1lKCksDQorICAgICAg
ICAgICAgICAgICAgICAgICAgbW9uaXRvcmVkVGhyZWFkLmdldEFjdGl2ZVRpbWVJbk1pbGxpcygp
KSk7DQorICAgICAgICAgICAgfQ0KKyAgICAgICAgfQ0KKyAgICB9DQorDQorICAgIEBPdmVycmlk
ZQ0KKyAgICBwdWJsaWMgdm9pZCBiYWNrZ3JvdW5kUHJvY2VzcygpIHsNCisgICAgICAgIHN1cGVy
LmJhY2tncm91bmRQcm9jZXNzKCk7DQorDQorICAgICAgICBsb25nIHRocmVzaG9sZEluTWlsbGlz
ID0gdGhyZXNob2xkICogMTAwMDsNCisNCisgICAgICAgIC8vQ2hlY2sgbW9uaXRvcmVkIHRocmVh
ZHMNCisgICAgICAgIGZvciAoTW9uaXRvcmVkVGhyZWFkIG1vbml0b3JlZFRocmVhZCA6IGFjdGl2
ZVRocmVhZHMudmFsdWVzKCkpIHsNCisgICAgICAgICAgICBsb25nIGFjdGl2ZVRpbWUgPSBtb25p
dG9yZWRUaHJlYWQuZ2V0QWN0aXZlVGltZUluTWlsbGlzKCk7DQorDQorICAgICAgICAgICAgaWYg
KCFtb25pdG9yZWRUaHJlYWQuaXNNYXJrZWRBc1N0dWNrKCkgJiYgYWN0aXZlVGltZSA+PSB0aHJl
c2hvbGRJbk1pbGxpcykgew0KKyAgICAgICAgICAgICAgICBpbnQgbnVtU3R1Y2tUaHJlYWRzID0g
c3R1Y2tDb3VudC5pbmNyZW1lbnRBbmRHZXQoKTsNCisgICAgICAgICAgICAgICAgbW9uaXRvcmVk
VGhyZWFkLm1hcmtBc1N0dWNrKCk7DQorICAgICAgICAgICAgICAgIG5vdGlmeVN0dWNrVGhyZWFk
RGV0ZWN0ZWQobW9uaXRvcmVkVGhyZWFkLmdldFRocmVhZCgpLmdldE5hbWUoKSwNCisgICAgICAg
ICAgICAgICAgICAgICAgICBtb25pdG9yZWRUaHJlYWQuZ2V0VGhyZWFkKCkuZ2V0U3RhY2tUcmFj
ZSgpLA0KKyAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZVRpbWUsIG1vbml0b3JlZFRocmVh
ZC5nZXRTdGFydFRpbWUoKSwgbnVtU3R1Y2tUaHJlYWRzKTsNCisgICAgICAgICAgICB9DQorICAg
ICAgICB9DQorICAgICAgICAvL0NoZWNrIGlmIGFueSB0aHJlYWRzIHByZXZpb3VzbHkgcmVwb3J0
ZWQgYXMgc3R1Y2ssIGhhdmUgZmluaXNoZWQuDQorICAgICAgICBDb21wbGV0ZWRTdHVja1RocmVh
ZCBjb21wbGV0ZWRTdHVja1RocmVhZCA9IGNvbXBsZXRlZFN0dWNrVGhyZWFkc1F1ZXVlLnBvbGwo
KTsNCisgICAgICAgIHdoaWxlIChjb21wbGV0ZWRTdHVja1RocmVhZCAhPSBudWxsKSB7DQorICAg
ICAgICAgICAgaW50IG51bVN0dWNrVGhyZWFkcyA9IHN0dWNrQ291bnQuZGVjcmVtZW50QW5kR2V0
KCk7DQorICAgICAgICAgICAgbm90aWZ5U3R1Y2tUaHJlYWRDb21wbGV0ZWQoY29tcGxldGVkU3R1
Y2tUaHJlYWQuZ2V0TmFtZSgpLA0KKyAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkU3R1Y2tU
aHJlYWQuZ2V0VG90YWxBY3RpdmVUaW1lKCksIG51bVN0dWNrVGhyZWFkcyk7DQorICAgICAgICAg
ICAgY29tcGxldGVkU3R1Y2tUaHJlYWQgPSBjb21wbGV0ZWRTdHVja1RocmVhZHNRdWV1ZS5wb2xs
KCk7DQorICAgICAgICB9DQorICAgIH0NCisNCisgICAgcHJpdmF0ZSBjbGFzcyBNb25pdG9yZWRU
aHJlYWQgew0KKw0KKyAgICAgICAgLyoqDQorICAgICAgICAgKiBSZWZlcmVuY2UgdG8gdGhlIHRo
cmVhZCB0byBnZXQgYSBzdGFjayB0cmFjZSBmcm9tIGJhY2tncm91bmQgdGFzaw0KKyAgICAgICAg
ICovDQorICAgICAgICBwcml2YXRlIFRocmVhZCB0aHJlYWQ7DQorICAgICAgICBwcml2YXRlIGxv
bmcgc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsNCisgICAgICAgIHByaXZhdGUg
dm9sYXRpbGUgYm9vbGVhbiBpc1N0dWNrID0gZmFsc2U7DQorDQorICAgICAgICBwdWJsaWMgTW9u
aXRvcmVkVGhyZWFkKFRocmVhZCB0aHJlYWQpIHsNCisgICAgICAgICAgICB0aGlzLnRocmVhZCA9
IHRocmVhZDsNCisgICAgICAgIH0NCisNCisgICAgICAgIHB1YmxpYyBUaHJlYWQgZ2V0VGhyZWFk
KCkgew0KKyAgICAgICAgICAgIHJldHVybiB0aGlzLnRocmVhZDsNCisgICAgICAgIH0NCisNCisg
ICAgICAgIHB1YmxpYyBsb25nIGdldEFjdGl2ZVRpbWVJbk1pbGxpcygpIHsNCisgICAgICAgICAg
ICByZXR1cm4gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkgLSBzdGFydDsNCisgICAgICAgIH0N
CisNCisgICAgICAgIHB1YmxpYyBEYXRlIGdldFN0YXJ0VGltZSgpIHsNCisgICAgICAgICAgICBy
ZXR1cm4gbmV3IERhdGUoc3RhcnQpOw0KKyAgICAgICAgfQ0KKw0KKyAgICAgICAgcHVibGljIHZv
aWQgbWFya0FzU3R1Y2soKSB7DQorICAgICAgICAgICAgdGhpcy5pc1N0dWNrID0gdHJ1ZTsNCisg
ICAgICAgIH0NCisNCisgICAgICAgIHB1YmxpYyBib29sZWFuIGlzTWFya2VkQXNTdHVjaygpIHsN
CisgICAgICAgICAgICByZXR1cm4gdGhpcy5pc1N0dWNrOw0KKyAgICAgICAgfQ0KKyAgICB9DQor
DQorICAgIHByaXZhdGUgY2xhc3MgQ29tcGxldGVkU3R1Y2tUaHJlYWQgew0KKw0KKyAgICAgICAg
cHJpdmF0ZSBTdHJpbmcgdGhyZWFkTmFtZTsNCisgICAgICAgIHByaXZhdGUgbG9uZyB0b3RhbEFj
dGl2ZVRpbWU7DQorDQorICAgICAgICBwdWJsaWMgQ29tcGxldGVkU3R1Y2tUaHJlYWQoU3RyaW5n
IHRocmVhZE5hbWUsIGxvbmcgdG90YWxBY3RpdmVUaW1lKSB7DQorICAgICAgICAgICAgdGhpcy50
aHJlYWROYW1lID0gdGhyZWFkTmFtZTsNCisgICAgICAgICAgICB0aGlzLnRvdGFsQWN0aXZlVGlt
ZSA9IHRvdGFsQWN0aXZlVGltZTsNCisgICAgICAgIH0NCisNCisgICAgICAgIHB1YmxpYyBTdHJp
bmcgZ2V0TmFtZSgpIHsNCisgICAgICAgICAgICByZXR1cm4gdGhpcy50aHJlYWROYW1lOw0KKyAg
ICAgICAgfQ0KKw0KKyAgICAgICAgcHVibGljIGxvbmcgZ2V0VG90YWxBY3RpdmVUaW1lKCkgew0K
KyAgICAgICAgICAgIHJldHVybiB0aGlzLnRvdGFsQWN0aXZlVGltZTsNCisgICAgICAgIH0NCisg
ICAgfQ0KK30NCiNFTkQ=
</data>

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>28961</attachid>
            <date>2012-06-19 12:45:00 +0000</date>
            <delta_ts>2012-06-20 09:06:47 +0000</delta_ts>
            <desc>2012-06-19_tc6_50306_StuckThreadDetectionValve.patch</desc>
            <filename>2012-06-19_tc6_50306_StuckThreadDetectionValve.patch</filename>
            <type>text/plain</type>
            <size>16070</size>
            <attacher name="Konstantin Kolinko">knst.kolinko</attacher>
            
              <data encoding="base64">SW5kZXg6IGphdmEvb3JnL2FwYWNoZS9jYXRhbGluYS92YWx2ZXMvTG9jYWxTdHJpbmdzLnByb3Bl
cnRpZXMNCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT0NCi0tLSBqYXZhL29yZy9hcGFjaGUvY2F0YWxpbmEvdmFsdmVzL0xv
Y2FsU3RyaW5ncy5wcm9wZXJ0aWVzCShyZXZpc2lvbiAxMzUxNjAxKQ0KKysrIGphdmEvb3JnL2Fw
YWNoZS9jYXRhbGluYS92YWx2ZXMvTG9jYWxTdHJpbmdzLnByb3BlcnRpZXMJKHdvcmtpbmcgY29w
eSkNCkBAIC01Niw2ICs1NiwxMCBAQA0KIAogc3NsVmFsdmUuaW52YWxpZFByb3ZpZGVyPVRoZSBT
U0wgcHJvdmlkZXIgc3BlY2lmaWVkIG9uIHRoZSBjb25uZWN0b3IgYXNzb2NpYXRlZCB3aXRoIHRo
aXMgcmVxdWVzdCBvZiBbezB9XSBpcyBpbnZhbGlkLiBUaGUgY2VydGlmaWNhdGUgZGF0YSBjb3Vs
ZCBub3QgYmUgcHJvY2Vzc2VkLgogCisjU3R1Y2sgdGhyZWFkIGRldGVjdGlvbiBWYWx2ZQorc3R1
Y2tUaHJlYWREZXRlY3Rpb25WYWx2ZS5ub3RpZnlTdHVja1RocmVhZERldGVjdGVkPVRocmVhZCAi
ezB9IiAoaWQ9ezZ9KSBoYXMgYmVlbiBhY3RpdmUgZm9yIHsxfSBtaWxsaXNlY29uZHMgKHNpbmNl
IHsyfSkgdG8gc2VydmUgdGhlIHNhbWUgcmVxdWVzdCBmb3IgezR9IGFuZCBtYXkgYmUgc3R1Y2sg
KGNvbmZpZ3VyZWQgdGhyZXNob2xkIGZvciB0aGlzIFN0dWNrVGhyZWFkRGV0ZWN0aW9uVmFsdmUg
aXMgezV9IHNlY29uZHMpLiBUaGVyZSBpcy9hcmUgezN9IHRocmVhZChzKSBpbiB0b3RhbCB0aGF0
IGFyZSBtb25pdG9yZWQgYnkgdGhpcyBWYWx2ZSBhbmQgbWF5IGJlIHN0dWNrLgorc3R1Y2tUaHJl
YWREZXRlY3Rpb25WYWx2ZS5ub3RpZnlTdHVja1RocmVhZENvbXBsZXRlZD1UaHJlYWQgInswfSIg
KGlkPXszfSkgd2FzIHByZXZpb3VzbHkgcmVwb3J0ZWQgdG8gYmUgc3R1Y2sgYnV0IGhhcyBjb21w
bGV0ZWQuIEl0IHdhcyBhY3RpdmUgZm9yIGFwcHJveGltYXRlbHkgezF9IG1pbGxpc2Vjb25kcy57
MixjaG9pY2UsMCN8MDwgVGhlcmUgaXMvYXJlIHN0aWxsIHsyfSB0aHJlYWQocykgdGhhdCBhcmUg
bW9uaXRvcmVkIGJ5IHRoaXMgVmFsdmUgYW5kIG1heSBiZSBzdHVjay59CisKICMgSFRUUCBzdGF0
dXMgcmVwb3J0cwogaHR0cC4xMDA9VGhlIGNsaWVudCBtYXkgY29udGludWUgKHswfSkuCiBodHRw
LjEwMT1UaGUgc2VydmVyIGlzIHN3aXRjaGluZyBwcm90b2NvbHMgYWNjb3JkaW5nIHRvIHRoZSAi
VXBncmFkZSIgaGVhZGVyICh7MH0pLgpJbmRleDogamF2YS9vcmcvYXBhY2hlL2NhdGFsaW5hL3Zh
bHZlcy9tYmVhbnMtZGVzY3JpcHRvcnMueG1sDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLS0gamF2YS9vcmcvYXBh
Y2hlL2NhdGFsaW5hL3ZhbHZlcy9tYmVhbnMtZGVzY3JpcHRvcnMueG1sCShyZXZpc2lvbiAxMzUx
NjAxKQ0KKysrIGphdmEvb3JnL2FwYWNoZS9jYXRhbGluYS92YWx2ZXMvbWJlYW5zLWRlc2NyaXB0
b3JzLnhtbAkod29ya2luZyBjb3B5KQ0KQEAgLTQ1OSw0ICs0NTksMzEgQEANCiAgICAgICAgICAg
ICAgICB3cml0ZWFibGU9ImZhbHNlIiAvPgogICAgICAgICAgICAgICAgCiAgIDwvbWJlYW4+CisK
KyAgPG1iZWFuIG5hbWU9IlN0dWNrVGhyZWFkRGV0ZWN0aW9uVmFsdmUiCisgICAgICAgICBkZXNj
cmlwdGlvbj0iRGV0ZWN0IGxvbmcgcmVxdWVzdHMgZm9yIHdoaWNoIHRoZWlyIHRocmVhZCBtaWdo
dCBiZSBzdHVjayIKKyAgICAgICAgIGRvbWFpbj0iQ2F0YWxpbmEiCisgICAgICAgICBncm91cD0i
VmFsdmUiCisgICAgICAgICB0eXBlPSJvcmcuYXBhY2hlLmNhdGFsaW5hLnZhbHZlcy5TdHVja1Ro
cmVhZERldGVjdGlvblZhbHZlIj4KKworICAgIDxhdHRyaWJ1dGUgbmFtZT0iY2xhc3NOYW1lIgor
ICAgICAgICAgICAgICAgZGVzY3JpcHRpb249IkZ1bGx5IHF1YWxpZmllZCBjbGFzcyBuYW1lIG9m
IHRoZSBtYW5hZ2VkIG9iamVjdCIKKyAgICAgICAgICAgICAgIHR5cGU9ImphdmEubGFuZy5TdHJp
bmciCisgICAgICAgICAgICAgICB3cml0ZWFibGU9ImZhbHNlIi8+CisKKyAgICA8YXR0cmlidXRl
IG5hbWU9InN0dWNrVGhyZWFkSWRzIgorICAgICAgICAgICAgICAgZGVzY3JpcHRpb249IklEcyBv
ZiB0aGUgdGhyZWFkcyBjdXJyZW50bHkgY29uc2lkZXJlZCBzdHVjay4gRWFjaCBJRCBjYW4gdGhl
biBiZSB1c2VkIHdpdGggdGhlIFRocmVhZE1YQmVhbiB0byByZXRyaWV2ZSBkYXRhIGFib3V0IGl0
LiIKKyAgICAgICAgICAgICAgIHR5cGU9ImxvbmdbXSIKKyAgICAgICAgICAgICAgIHdyaXRlYWJs
ZT0iZmFsc2UiLz4KKworICAgIDxhdHRyaWJ1dGUgbmFtZT0ic3R1Y2tUaHJlYWROYW1lcyIKKyAg
ICAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJOYW1lcyBvZiB0aGUgdGhyZWFkcyBjdXJyZW50bHkg
Y29uc2lkZXJlZCBzdHVjay4iCisgICAgICAgICAgICAgICB0eXBlPSJqYXZhLmxhbmcuU3RyaW5n
W10iCisgICAgICAgICAgICAgICB3cml0ZWFibGU9ImZhbHNlIi8+CisKKyAgICA8YXR0cmlidXRl
IG5hbWU9InRocmVzaG9sZCIKKyAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJEdXJhdGlvbiBp
biBzZWNvbmRzIGFmdGVyIHdoaWNoIGEgcmVxdWVzdCBpcyBjb25zaWRlcmVkIGFzIHN0dWNrIgor
ICAgICAgICAgICAgICAgdHlwZT0iaW50Ii8+CisKKyAgPC9tYmVhbj4KIDwvbWJlYW5zLWRlc2Ny
aXB0b3JzPgpJbmRleDogamF2YS9vcmcvYXBhY2hlL2NhdGFsaW5hL3ZhbHZlcy9TdHVja1RocmVh
ZERldGVjdGlvblZhbHZlLmphdmENCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSBqYXZhL29yZy9hcGFjaGUvY2F0
YWxpbmEvdmFsdmVzL1N0dWNrVGhyZWFkRGV0ZWN0aW9uVmFsdmUuamF2YQkocmV2aXNpb24gMCkN
CisrKyBqYXZhL29yZy9hcGFjaGUvY2F0YWxpbmEvdmFsdmVzL1N0dWNrVGhyZWFkRGV0ZWN0aW9u
VmFsdmUuamF2YQkod29ya2luZyBjb3B5KQ0KQEAgLTAsMCArMSwyOTggQEANCisvKgorICogTGlj
ZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZSBv
ciBtb3JlCisgKiBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElD
RSBmaWxlIGRpc3RyaWJ1dGVkIHdpdGgKKyAqIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZv
cm1hdGlvbiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4KKyAqIFRoZSBBU0YgbGljZW5z
ZXMgdGhpcyBmaWxlIHRvIFlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4w
CisgKiAodGhlICJMaWNlbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGlu
IGNvbXBsaWFuY2Ugd2l0aAorICogdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkg
b2YgdGhlIExpY2Vuc2UgYXQKKyAqCisgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNl
bnNlcy9MSUNFTlNFLTIuMAorICoKKyAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxh
dyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKKyAqIGRpc3RyaWJ1dGVkIHVuZGVy
IHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCisgKiBXSVRI
T1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mg
b3IgaW1wbGllZC4KKyAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdl
IGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKKyAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNl
bnNlLgorICovCitwYWNrYWdlIG9yZy5hcGFjaGUuY2F0YWxpbmEudmFsdmVzOworCitpbXBvcnQg
amF2YS5pby5JT0V4Y2VwdGlvbjsKK2ltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OworaW1wb3J0
IGphdmEudXRpbC5EYXRlOworaW1wb3J0IGphdmEudXRpbC5MaXN0OworaW1wb3J0IGphdmEudXRp
bC5RdWV1ZTsKK2ltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50SGFzaE1hcDsK
K2ltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50TGlua2VkUXVldWU7CitpbXBv
cnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21pY0ludGVnZXI7CisKK2ltcG9ydCBq
YXZheC5zZXJ2bGV0LlNlcnZsZXRFeGNlcHRpb247CisKK2ltcG9ydCBvcmcuYXBhY2hlLmNhdGFs
aW5hLmNvbm5lY3Rvci5SZXF1ZXN0OworaW1wb3J0IG9yZy5hcGFjaGUuY2F0YWxpbmEuY29ubmVj
dG9yLlJlc3BvbnNlOworaW1wb3J0IG9yZy5hcGFjaGUuanVsaS5sb2dnaW5nLkxvZzsKK2ltcG9y
dCBvcmcuYXBhY2hlLmp1bGkubG9nZ2luZy5Mb2dGYWN0b3J5OworaW1wb3J0IG9yZy5hcGFjaGUu
dG9tY2F0LnV0aWwucmVzLlN0cmluZ01hbmFnZXI7CisKKy8qKgorICogVGhpcyB2YWx2ZSBhbGxv
d3MgdG8gZGV0ZWN0IHJlcXVlc3RzIHRoYXQgdGFrZSBhIGxvbmcgdGltZSB0byBwcm9jZXNzLCB3
aGljaAorICogbWlnaHQgaW5kaWNhdGUgdGhhdCB0aGUgdGhyZWFkIHRoYXQgaXMgcHJvY2Vzc2lu
ZyBpdCBpcyBzdHVjay4KKyAqLworcHVibGljIGNsYXNzIFN0dWNrVGhyZWFkRGV0ZWN0aW9uVmFs
dmUgZXh0ZW5kcyBWYWx2ZUJhc2UgeworCisgICAgLyoqCisgICAgICogTG9nZ2VyCisgICAgICov
CisgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nIGxvZyA9IExvZ0ZhY3RvcnkuZ2V0TG9nKFN0
dWNrVGhyZWFkRGV0ZWN0aW9uVmFsdmUuY2xhc3MpOworCisgICAgLyoqCisgICAgICogVGhlIHN0
cmluZyBtYW5hZ2VyIGZvciB0aGlzIHBhY2thZ2UuCisgICAgICovCisgICAgcHJpdmF0ZSBzdGF0
aWMgZmluYWwgU3RyaW5nTWFuYWdlciBzbSA9CisgICAgICAgIFN0cmluZ01hbmFnZXIuZ2V0TWFu
YWdlcihDb25zdGFudHMuUGFja2FnZSk7CisKKyAgICAvKioKKyAgICAgKiBLZWVwcyBjb3VudCBv
ZiB0aGUgbnVtYmVyIG9mIHN0dWNrIHRocmVhZHMgZGV0ZWN0ZWQKKyAgICAgKi8KKyAgICBwcml2
YXRlIGZpbmFsIEF0b21pY0ludGVnZXIgc3R1Y2tDb3VudCA9IG5ldyBBdG9taWNJbnRlZ2VyKDAp
OworCisgICAgLyoqCisgICAgICogSW4gc2Vjb25kcy4gRGVmYXVsdCA2MDAgKDEwIG1pbnV0ZXMp
LgorICAgICAqLworICAgIHByaXZhdGUgaW50IHRocmVzaG9sZCA9IDYwMDsKKworICAgIC8qKgor
ICAgICAqIFRoZSBvbmx5IHJlZmVyZW5jZXMgd2Uga2VlcCB0byBhY3R1YWwgcnVubmluZyBUaHJl
YWQgb2JqZWN0cyBhcmUgaW4KKyAgICAgKiB0aGlzIE1hcCAod2hpY2ggaXMgYXV0b21hdGljYWxs
eSBjbGVhbmVkIGluIGludm9rZSgpcyBmaW5hbGx5IGNsYXVzZSkuCisgICAgICogVGhhdCB3YXks
IFRocmVhZHMgY2FuIGJlIEdDJ2VkLCBldmVudGhvdWdoIHRoZSBWYWx2ZSBzdGlsbCB0aGlua3Mg
dGhleQorICAgICAqIGFyZSBzdHVjayAoY2F1c2VkIGJ5IGEgbG9uZyBtb25pdG9yIGludGVydmFs
KQorICAgICAqLworICAgIHByaXZhdGUgZmluYWwgQ29uY3VycmVudEhhc2hNYXA8TG9uZywgTW9u
aXRvcmVkVGhyZWFkPiBhY3RpdmVUaHJlYWRzID0KKyAgICAgICAgICAgIG5ldyBDb25jdXJyZW50
SGFzaE1hcDxMb25nLCBNb25pdG9yZWRUaHJlYWQ+KCk7CisgICAgLyoqCisgICAgICoKKyAgICAg
Ki8KKyAgICBwcml2YXRlIGZpbmFsIFF1ZXVlPENvbXBsZXRlZFN0dWNrVGhyZWFkPiBjb21wbGV0
ZWRTdHVja1RocmVhZHNRdWV1ZSA9CisgICAgICAgICAgICBuZXcgQ29uY3VycmVudExpbmtlZFF1
ZXVlPENvbXBsZXRlZFN0dWNrVGhyZWFkPigpOworCisgICAgLyoqCisgICAgICogU3BlY2lmeSB0
aGUgdGhyZXNob2xkIChpbiBzZWNvbmRzKSB1c2VkIHdoZW4gY2hlY2tpbmcgZm9yIHN0dWNrIHRo
cmVhZHMuCisgICAgICogSWYgJmx0Oz0wLCB0aGUgZGV0ZWN0aW9uIGlzIGRpc2FibGVkLiBUaGUg
ZGVmYXVsdCBpcyA2MDAgc2Vjb25kcy4KKyAgICAgKgorICAgICAqIEBwYXJhbSB0aHJlc2hvbGQK
KyAgICAgKiAgICAgICAgICAgIFRoZSBuZXcgdGhyZXNob2xkIGluIHNlY29uZHMKKyAgICAgKi8K
KyAgICBwdWJsaWMgdm9pZCBzZXRUaHJlc2hvbGQoaW50IHRocmVzaG9sZCkgeworICAgICAgICB0
aGlzLnRocmVzaG9sZCA9IHRocmVzaG9sZDsKKyAgICB9CisKKyAgICAvKioKKyAgICAgKiBAc2Vl
ICNzZXRUaHJlc2hvbGQoaW50KQorICAgICAqIEByZXR1cm4gVGhlIGN1cnJlbnQgdGhyZXNob2xk
IGluIHNlY29uZHMKKyAgICAgKi8KKyAgICBwdWJsaWMgaW50IGdldFRocmVzaG9sZCgpIHsKKyAg
ICAgICAgcmV0dXJuIHRocmVzaG9sZDsKKyAgICB9CisKKworICAgIHByaXZhdGUgdm9pZCBub3Rp
ZnlTdHVja1RocmVhZERldGVjdGVkKE1vbml0b3JlZFRocmVhZCBtb25pdG9yZWRUaHJlYWQsCisg
ICAgICAgIGxvbmcgYWN0aXZlVGltZSwgaW50IG51bVN0dWNrVGhyZWFkcykgeworICAgICAgICBp
ZiAobG9nLmlzV2FybkVuYWJsZWQoKSkgeworICAgICAgICAgICAgU3RyaW5nIG1zZyA9IHNtLmdl
dFN0cmluZygKKyAgICAgICAgICAgICAgICAic3R1Y2tUaHJlYWREZXRlY3Rpb25WYWx2ZS5ub3Rp
ZnlTdHVja1RocmVhZERldGVjdGVkIiwKKyAgICAgICAgICAgICAgICBtb25pdG9yZWRUaHJlYWQu
Z2V0VGhyZWFkKCkuZ2V0TmFtZSgpLAorICAgICAgICAgICAgICAgIExvbmcudmFsdWVPZihhY3Rp
dmVUaW1lKSwKKyAgICAgICAgICAgICAgICBtb25pdG9yZWRUaHJlYWQuZ2V0U3RhcnRUaW1lKCks
CisgICAgICAgICAgICAgICAgSW50ZWdlci52YWx1ZU9mKG51bVN0dWNrVGhyZWFkcyksCisgICAg
ICAgICAgICAgICAgbW9uaXRvcmVkVGhyZWFkLmdldFJlcXVlc3RVcmkoKSwKKyAgICAgICAgICAg
ICAgICBJbnRlZ2VyLnZhbHVlT2YodGhyZXNob2xkKSwKKyAgICAgICAgICAgICAgICBTdHJpbmcu
dmFsdWVPZihtb25pdG9yZWRUaHJlYWQuZ2V0VGhyZWFkKCkuZ2V0SWQoKSkKKyAgICAgICAgICAg
ICAgICApOworICAgICAgICAgICAgLy8gbXNnICs9ICJcbiIgKyBnZXRTdGFja1RyYWNlQXNTdHJp
bmcodHJhY2UpOworICAgICAgICAgICAgVGhyb3dhYmxlIHRoID0gbmV3IFRocm93YWJsZSgpOwor
ICAgICAgICAgICAgdGguc2V0U3RhY2tUcmFjZShtb25pdG9yZWRUaHJlYWQuZ2V0VGhyZWFkKCku
Z2V0U3RhY2tUcmFjZSgpKTsKKyAgICAgICAgICAgIGxvZy53YXJuKG1zZywgdGgpOworICAgICAg
ICB9CisgICAgfQorCisgICAgcHJpdmF0ZSB2b2lkIG5vdGlmeVN0dWNrVGhyZWFkQ29tcGxldGVk
KENvbXBsZXRlZFN0dWNrVGhyZWFkIHRocmVhZCwKKyAgICAgICAgICAgIGludCBudW1TdHVja1Ro
cmVhZHMpIHsKKyAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpIHsKKyAgICAgICAgICAg
IFN0cmluZyBtc2cgPSBzbS5nZXRTdHJpbmcoCisgICAgICAgICAgICAgICAgInN0dWNrVGhyZWFk
RGV0ZWN0aW9uVmFsdmUubm90aWZ5U3R1Y2tUaHJlYWRDb21wbGV0ZWQiLAorICAgICAgICAgICAg
ICAgIHRocmVhZC5nZXROYW1lKCksCisgICAgICAgICAgICAgICAgTG9uZy52YWx1ZU9mKHRocmVh
ZC5nZXRUb3RhbEFjdGl2ZVRpbWUoKSksCisgICAgICAgICAgICAgICAgSW50ZWdlci52YWx1ZU9m
KG51bVN0dWNrVGhyZWFkcyksCisgICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVlT2YodGhyZWFk
LmdldElkKCkpKTsKKyAgICAgICAgICAgIC8vIFNpbmNlIHRoZSAic3R1Y2sgdGhyZWFkIG5vdGlm
aWNhdGlvbiIgaXMgd2FybiwgdGhpcyBzaG91bGQgYWxzbworICAgICAgICAgICAgLy8gYmUgd2Fy
bgorICAgICAgICAgICAgbG9nLndhcm4obXNnKTsKKyAgICAgICAgfQorICAgIH0KKworICAgIC8q
KgorICAgICAqIHtAaW5oZXJpdERvY30KKyAgICAgKi8KKyAgICBAT3ZlcnJpZGUKKyAgICBwdWJs
aWMgdm9pZCBpbnZva2UoUmVxdWVzdCByZXF1ZXN0LCBSZXNwb25zZSByZXNwb25zZSkKKyAgICAg
ICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgU2VydmxldEV4Y2VwdGlvbiB7CisKKyAgICAgICAg
aWYgKHRocmVzaG9sZCA8PSAwKSB7CisgICAgICAgICAgICAvLyBzaG9ydC1jaXJjdWl0IGlmIG5v
dCBtb25pdG9yaW5nIHN0dWNrIHRocmVhZHMKKyAgICAgICAgICAgIGdldE5leHQoKS5pbnZva2Uo
cmVxdWVzdCwgcmVzcG9uc2UpOworICAgICAgICAgICAgcmV0dXJuOworICAgICAgICB9CisKKyAg
ICAgICAgLy8gU2F2ZSB0aGUgdGhyZWFkL3J1bm5hYmxlCisgICAgICAgIC8vIEtlZXBpbmcgYSBy
ZWZlcmVuY2UgdG8gdGhlIHRocmVhZCBvYmplY3QgaGVyZSBkb2VzIG5vdCBwcmV2ZW50CisgICAg
ICAgIC8vIEdDJ2luZywgYXMgdGhlIHJlZmVyZW5jZSBpcyByZW1vdmVkIGZyb20gdGhlIE1hcCBp
biB0aGUgZmluYWxseSBjbGF1c2UKKworICAgICAgICBMb25nIGtleSA9IExvbmcudmFsdWVPZihU
aHJlYWQuY3VycmVudFRocmVhZCgpLmdldElkKCkpOworICAgICAgICBTdHJpbmdCdWZmZXIgcmVx
dWVzdFVybCA9IHJlcXVlc3QuZ2V0UmVxdWVzdFVSTCgpOworICAgICAgICBpZihyZXF1ZXN0Lmdl
dFF1ZXJ5U3RyaW5nKCkhPW51bGwpIHsKKyAgICAgICAgICAgIHJlcXVlc3RVcmwuYXBwZW5kKCI/
Iik7CisgICAgICAgICAgICByZXF1ZXN0VXJsLmFwcGVuZChyZXF1ZXN0LmdldFF1ZXJ5U3RyaW5n
KCkpOworICAgICAgICB9CisgICAgICAgIE1vbml0b3JlZFRocmVhZCBtb25pdG9yZWRUaHJlYWQg
PSBuZXcgTW9uaXRvcmVkVGhyZWFkKFRocmVhZC5jdXJyZW50VGhyZWFkKCksCisgICAgICAgICAg
ICByZXF1ZXN0VXJsLnRvU3RyaW5nKCkpOworICAgICAgICBhY3RpdmVUaHJlYWRzLnB1dChrZXks
IG1vbml0b3JlZFRocmVhZCk7CisKKyAgICAgICAgdHJ5IHsKKyAgICAgICAgICAgIGdldE5leHQo
KS5pbnZva2UocmVxdWVzdCwgcmVzcG9uc2UpOworICAgICAgICB9IGZpbmFsbHkgeworICAgICAg
ICAgICAgYWN0aXZlVGhyZWFkcy5yZW1vdmUoa2V5KTsKKyAgICAgICAgICAgIGlmIChtb25pdG9y
ZWRUaHJlYWQubWFya0FzRG9uZSgpID09IE1vbml0b3JlZFRocmVhZFN0YXRlLlNUVUNLKSB7Cisg
ICAgICAgICAgICAgICAgY29tcGxldGVkU3R1Y2tUaHJlYWRzUXVldWUuYWRkKAorICAgICAgICAg
ICAgICAgICAgICAgICAgbmV3IENvbXBsZXRlZFN0dWNrVGhyZWFkKG1vbml0b3JlZFRocmVhZC5n
ZXRUaHJlYWQoKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb25pdG9yZWRUaHJlYWQu
Z2V0QWN0aXZlVGltZUluTWlsbGlzKCkpKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfQorICAg
IH0KKworICAgIEBPdmVycmlkZQorICAgIHB1YmxpYyB2b2lkIGJhY2tncm91bmRQcm9jZXNzKCkg
eworICAgICAgICBzdXBlci5iYWNrZ3JvdW5kUHJvY2VzcygpOworCisgICAgICAgIGxvbmcgdGhy
ZXNob2xkSW5NaWxsaXMgPSB0aHJlc2hvbGQgKiAxMDAwOworCisgICAgICAgIC8vIENoZWNrIG1v
bml0b3JlZCB0aHJlYWRzLCBiZWluZyBjYXJlZnVsIHRoYXQgdGhlIHJlcXVlc3QgbWlnaHQgaGF2
ZQorICAgICAgICAvLyBjb21wbGV0ZWQgYnkgdGhlIHRpbWUgd2UgZXhhbWluZSBpdAorICAgICAg
ICBmb3IgKE1vbml0b3JlZFRocmVhZCBtb25pdG9yZWRUaHJlYWQgOiBhY3RpdmVUaHJlYWRzLnZh
bHVlcygpKSB7CisgICAgICAgICAgICBsb25nIGFjdGl2ZVRpbWUgPSBtb25pdG9yZWRUaHJlYWQu
Z2V0QWN0aXZlVGltZUluTWlsbGlzKCk7CisKKyAgICAgICAgICAgIGlmIChhY3RpdmVUaW1lID49
IHRocmVzaG9sZEluTWlsbGlzICYmIG1vbml0b3JlZFRocmVhZC5tYXJrQXNTdHVja0lmU3RpbGxS
dW5uaW5nKCkpIHsKKyAgICAgICAgICAgICAgICBpbnQgbnVtU3R1Y2tUaHJlYWRzID0gc3R1Y2tD
b3VudC5pbmNyZW1lbnRBbmRHZXQoKTsKKyAgICAgICAgICAgICAgICBub3RpZnlTdHVja1RocmVh
ZERldGVjdGVkKG1vbml0b3JlZFRocmVhZCwgYWN0aXZlVGltZSwgbnVtU3R1Y2tUaHJlYWRzKTsK
KyAgICAgICAgICAgIH0KKyAgICAgICAgfQorICAgICAgICAvLyBDaGVjayBpZiBhbnkgdGhyZWFk
cyBwcmV2aW91c2x5IHJlcG9ydGVkIGFzIHN0dWNrLCBoYXZlIGZpbmlzaGVkLgorICAgICAgICBm
b3IgKENvbXBsZXRlZFN0dWNrVGhyZWFkIGNvbXBsZXRlZFN0dWNrVGhyZWFkID0gY29tcGxldGVk
U3R1Y2tUaHJlYWRzUXVldWUucG9sbCgpOworICAgICAgICAgICAgY29tcGxldGVkU3R1Y2tUaHJl
YWQgIT0gbnVsbDsgY29tcGxldGVkU3R1Y2tUaHJlYWQgPSBjb21wbGV0ZWRTdHVja1RocmVhZHNR
dWV1ZS5wb2xsKCkpIHsKKworICAgICAgICAgICAgaW50IG51bVN0dWNrVGhyZWFkcyA9IHN0dWNr
Q291bnQuZGVjcmVtZW50QW5kR2V0KCk7CisgICAgICAgICAgICBub3RpZnlTdHVja1RocmVhZENv
bXBsZXRlZChjb21wbGV0ZWRTdHVja1RocmVhZCwgbnVtU3R1Y2tUaHJlYWRzKTsKKyAgICAgICAg
fQorICAgIH0KKworICAgIHB1YmxpYyBsb25nW10gZ2V0U3R1Y2tUaHJlYWRJZHMoKSB7CisgICAg
ICAgIExpc3Q8TG9uZz4gaWRMaXN0ID0gbmV3IEFycmF5TGlzdDxMb25nPigpOworICAgICAgICBm
b3IgKE1vbml0b3JlZFRocmVhZCBtb25pdG9yZWRUaHJlYWQgOiBhY3RpdmVUaHJlYWRzLnZhbHVl
cygpKSB7CisgICAgICAgICAgICBpZiAobW9uaXRvcmVkVGhyZWFkLmlzTWFya2VkQXNTdHVjaygp
KSB7CisgICAgICAgICAgICAgICAgaWRMaXN0LmFkZChMb25nLnZhbHVlT2YobW9uaXRvcmVkVGhy
ZWFkLmdldFRocmVhZCgpLmdldElkKCkpKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfQorCisg
ICAgICAgIGxvbmdbXSByZXN1bHQgPSBuZXcgbG9uZ1tpZExpc3Quc2l6ZSgpXTsKKyAgICAgICAg
Zm9yIChpbnQgaSA9IDA7IGkgPCByZXN1bHQubGVuZ3RoOyBpKyspIHsKKyAgICAgICAgICAgIHJl
c3VsdFtpXSA9IGlkTGlzdC5nZXQoaSkubG9uZ1ZhbHVlKCk7CisgICAgICAgIH0KKyAgICAgICAg
cmV0dXJuIHJlc3VsdDsKKyAgICB9CisKKyAgICBwdWJsaWMgU3RyaW5nW10gZ2V0U3R1Y2tUaHJl
YWROYW1lcygpIHsKKyAgICAgICAgTGlzdDxTdHJpbmc+IG5hbWVMaXN0ID0gbmV3IEFycmF5TGlz
dDxTdHJpbmc+KCk7CisgICAgICAgIGZvciAoTW9uaXRvcmVkVGhyZWFkIG1vbml0b3JlZFRocmVh
ZCA6IGFjdGl2ZVRocmVhZHMudmFsdWVzKCkpIHsKKyAgICAgICAgICAgIGlmIChtb25pdG9yZWRU
aHJlYWQuaXNNYXJrZWRBc1N0dWNrKCkpIHsKKyAgICAgICAgICAgICAgICBuYW1lTGlzdC5hZGQo
bW9uaXRvcmVkVGhyZWFkLmdldFRocmVhZCgpLmdldE5hbWUoKSk7CisgICAgICAgICAgICB9Cisg
ICAgICAgIH0KKyAgICAgICAgcmV0dXJuIG5hbWVMaXN0LnRvQXJyYXkobmV3IFN0cmluZ1tuYW1l
TGlzdC5zaXplKCldKTsKKyAgICB9CisKKyAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBNb25pdG9y
ZWRUaHJlYWQgeworCisgICAgICAgIC8qKgorICAgICAgICAgKiBSZWZlcmVuY2UgdG8gdGhlIHRo
cmVhZCB0byBnZXQgYSBzdGFjayB0cmFjZSBmcm9tIGJhY2tncm91bmQgdGFzaworICAgICAgICAg
Ki8KKyAgICAgICAgcHJpdmF0ZSBmaW5hbCBUaHJlYWQgdGhyZWFkOworICAgICAgICBwcml2YXRl
IGZpbmFsIFN0cmluZyByZXF1ZXN0VXJpOworICAgICAgICBwcml2YXRlIGZpbmFsIGxvbmcgc3Rh
cnQ7CisgICAgICAgIHByaXZhdGUgZmluYWwgQXRvbWljSW50ZWdlciBzdGF0ZSA9IG5ldyBBdG9t
aWNJbnRlZ2VyKAorICAgICAgICAgICAgTW9uaXRvcmVkVGhyZWFkU3RhdGUuUlVOTklORy5vcmRp
bmFsKCkpOworCisgICAgICAgIHB1YmxpYyBNb25pdG9yZWRUaHJlYWQoVGhyZWFkIHRocmVhZCwg
U3RyaW5nIHJlcXVlc3RVcmkpIHsKKyAgICAgICAgICAgIHRoaXMudGhyZWFkID0gdGhyZWFkOwor
ICAgICAgICAgICAgdGhpcy5yZXF1ZXN0VXJpID0gcmVxdWVzdFVyaTsKKyAgICAgICAgICAgIHRo
aXMuc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKKyAgICAgICAgfQorCisgICAg
ICAgIHB1YmxpYyBUaHJlYWQgZ2V0VGhyZWFkKCkgeworICAgICAgICAgICAgcmV0dXJuIHRoaXMu
dGhyZWFkOworICAgICAgICB9CisKKyAgICAgICAgcHVibGljIFN0cmluZyBnZXRSZXF1ZXN0VXJp
KCkgeworICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RVcmk7CisgICAgICAgIH0KKworICAgICAg
ICBwdWJsaWMgbG9uZyBnZXRBY3RpdmVUaW1lSW5NaWxsaXMoKSB7CisgICAgICAgICAgICByZXR1
cm4gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkgLSBzdGFydDsKKyAgICAgICAgfQorCisgICAg
ICAgIHB1YmxpYyBEYXRlIGdldFN0YXJ0VGltZSgpIHsKKyAgICAgICAgICAgIHJldHVybiBuZXcg
RGF0ZShzdGFydCk7CisgICAgICAgIH0KKworICAgICAgICBwdWJsaWMgYm9vbGVhbiBtYXJrQXNT
dHVja0lmU3RpbGxSdW5uaW5nKCkgeworICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuY29t
cGFyZUFuZFNldChNb25pdG9yZWRUaHJlYWRTdGF0ZS5SVU5OSU5HLm9yZGluYWwoKSwKKyAgICAg
ICAgICAgICAgICBNb25pdG9yZWRUaHJlYWRTdGF0ZS5TVFVDSy5vcmRpbmFsKCkpOworICAgICAg
ICB9CisKKyAgICAgICAgcHVibGljIE1vbml0b3JlZFRocmVhZFN0YXRlIG1hcmtBc0RvbmUoKSB7
CisgICAgICAgICAgICBpbnQgdmFsID0gdGhpcy5zdGF0ZS5nZXRBbmRTZXQoTW9uaXRvcmVkVGhy
ZWFkU3RhdGUuRE9ORS5vcmRpbmFsKCkpOworICAgICAgICAgICAgcmV0dXJuIE1vbml0b3JlZFRo
cmVhZFN0YXRlLnZhbHVlcygpW3ZhbF07CisgICAgICAgIH0KKworICAgICAgICBib29sZWFuIGlz
TWFya2VkQXNTdHVjaygpIHsKKyAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLmdldCgpID09
IE1vbml0b3JlZFRocmVhZFN0YXRlLlNUVUNLLm9yZGluYWwoKTsKKyAgICAgICAgfQorICAgIH0K
KworICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIENvbXBsZXRlZFN0dWNrVGhyZWFkIHsKKworICAg
ICAgICBwcml2YXRlIGZpbmFsIFN0cmluZyB0aHJlYWROYW1lOworICAgICAgICBwcml2YXRlIGZp
bmFsIGxvbmcgdGhyZWFkSWQ7CisgICAgICAgIHByaXZhdGUgZmluYWwgbG9uZyB0b3RhbEFjdGl2
ZVRpbWU7CisKKyAgICAgICAgcHVibGljIENvbXBsZXRlZFN0dWNrVGhyZWFkKFRocmVhZCB0aHJl
YWQsCisgICAgICAgICAgICAgICAgbG9uZyB0b3RhbEFjdGl2ZVRpbWUpIHsKKyAgICAgICAgICAg
IHRoaXMudGhyZWFkTmFtZSA9IHRocmVhZC5nZXROYW1lKCk7CisgICAgICAgICAgICB0aGlzLnRo
cmVhZElkID0gdGhyZWFkLmdldElkKCk7CisgICAgICAgICAgICB0aGlzLnRvdGFsQWN0aXZlVGlt
ZSA9IHRvdGFsQWN0aXZlVGltZTsKKyAgICAgICAgfQorCisgICAgICAgIHB1YmxpYyBTdHJpbmcg
Z2V0TmFtZSgpIHsKKyAgICAgICAgICAgIHJldHVybiB0aGlzLnRocmVhZE5hbWU7CisgICAgICAg
IH0KKworICAgICAgICBwdWJsaWMgbG9uZyBnZXRJZCgpIHsKKyAgICAgICAgICAgIHJldHVybiB0
aGlzLnRocmVhZElkOworICAgICAgICB9CisKKyAgICAgICAgcHVibGljIGxvbmcgZ2V0VG90YWxB
Y3RpdmVUaW1lKCkgeworICAgICAgICAgICAgcmV0dXJuIHRoaXMudG90YWxBY3RpdmVUaW1lOwor
ICAgICAgICB9CisgICAgfQorCisgICAgcHJpdmF0ZSBlbnVtIE1vbml0b3JlZFRocmVhZFN0YXRl
IHsKKyAgICAgICAgUlVOTklORywgU1RVQ0ssIERPTkU7CisgICAgfQorfQpJbmRleDogamF2YS9v
cmcvYXBhY2hlL2NhdGFsaW5hL3ZhbHZlcy9TdHVja1RocmVhZERldGVjdGlvblZhbHZlLmphdmEN
Cj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT0NCi0tLSBqYXZhL29yZy9hcGFjaGUvY2F0YWxpbmEvdmFsdmVzL1N0dWNrVGhy
ZWFkRGV0ZWN0aW9uVmFsdmUuamF2YQkocmV2aXNpb24gMCkNCisrKyBqYXZhL29yZy9hcGFjaGUv
Y2F0YWxpbmEvdmFsdmVzL1N0dWNrVGhyZWFkRGV0ZWN0aW9uVmFsdmUuamF2YQkod29ya2luZyBj
b3B5KQ0KDQpQcm9wZXJ0eSBjaGFuZ2VzIG9uOiBqYXZhL29yZy9hcGFjaGUvY2F0YWxpbmEvdmFs
dmVzL1N0dWNrVGhyZWFkRGV0ZWN0aW9uVmFsdmUuamF2YQ0KX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXw0KQWRkZWQ6IHN2
bjplb2wtc3R5bGUNCiMjIC0wLDAgKzEgIyMNCituYXRpdmUNClwgTm8gbmV3bGluZSBhdCBlbmQg
b2YgcHJvcGVydHkNCkluZGV4OiB3ZWJhcHBzL2RvY3MvY29uZmlnL3ZhbHZlLnhtbA0KPT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PQ0KLS0tIHdlYmFwcHMvZG9jcy9jb25maWcvdmFsdmUueG1sCShyZXZpc2lvbiAxMzUxNjAx
KQ0KKysrIHdlYmFwcHMvZG9jcy9jb25maWcvdmFsdmUueG1sCSh3b3JraW5nIGNvcHkpDQpAQCAt
ODczLDYgKzg3Myw0OCBAQA0KIDwvc2VjdGlvbj4KIAogCis8c2VjdGlvbiBuYW1lPSJTdHVjayBU
aHJlYWQgRGV0ZWN0aW9uIFZhbHZlIj4KKworICA8c3Vic2VjdGlvbiBuYW1lPSJJbnRyb2R1Y3Rp
b24iPgorCisgICAgPHA+VGhpcyB2YWx2ZSBhbGxvd3MgdG8gZGV0ZWN0IHJlcXVlc3RzIHRoYXQg
dGFrZSBhIGxvbmcgdGltZSB0byBwcm9jZXNzLCB3aGljaCBtaWdodAorICAgIGluZGljYXRlIHRo
YXQgdGhlIHRocmVhZCB0aGF0IGlzIHByb2Nlc3NpbmcgaXQgaXMgc3R1Y2suPC9wPgorICAgIDxw
PldoZW4gc3VjaCBhIHJlcXVlc3QgaXMgZGV0ZWN0ZWQsIHRoZSBjdXJyZW50IHN0YWNrIHRyYWNl
IG9mIGl0cyB0aHJlYWQgaXMgd3JpdHRlbgorICAgIHRvIFRvbWNhdCBsb2cgd2l0aCBhIFdBUk4g
bGV2ZWwuPC9wPgorICAgIDxwPlRoZSBJRHMgb2YgdGhlIHN0dWNrIHRocmVhZHMgYXJlIGF2YWls
YWJsZSB0aHJvdWdoIEpNWCBpbiB0aGUKKyAgICA8Y29kZT5zdHVja1RocmVhZElkczwvY29kZT4g
YXR0cmlidXRlLiBUaGUgSlZNIFRocmVhZCBNQmVhbiBjYW4gdGhlbiBiZSB1c2VkIHRvCisgICAg
cmV0cmlldmUgb3RoZXIgaW5mb3JtYXRpb24gYWJvdXQgZWFjaCBzdHVjayB0aHJlYWQgKG5hbWUs
IHN0YWNrIHRyYWNlLi4uKS48L3A+CisKKyAgPC9zdWJzZWN0aW9uPgorCisgIDxzdWJzZWN0aW9u
IG5hbWU9IkF0dHJpYnV0ZXMiPgorCisgICAgPHA+VGhlIDxzdHJvbmc+U3R1Y2sgVGhyZWFkIERl
dGVjdGlvbiBWYWx2ZTwvc3Ryb25nPiBzdXBwb3J0cyB0aGUKKyAgICBmb2xsb3dpbmcgY29uZmln
dXJhdGlvbiBhdHRyaWJ1dGVzOjwvcD4KKworICAgIDxhdHRyaWJ1dGVzPgorCisgICAgICA8YXR0
cmlidXRlIG5hbWU9ImNsYXNzTmFtZSIgcmVxdWlyZWQ9InRydWUiPgorICAgICAgICA8cD5KYXZh
IGNsYXNzIG5hbWUgb2YgdGhlIGltcGxlbWVudGF0aW9uIHRvIHVzZS4gIFRoaXMgTVVTVCBiZSBz
ZXQgdG8KKyAgICAgICAgPHN0cm9uZz5vcmcuYXBhY2hlLmNhdGFsaW5hLnZhbHZlcy5TdHVja1Ro
cmVhZERldGVjdGlvblZhbHZlPC9zdHJvbmc+LgorICAgICAgICA8L3A+CisgICAgICA8L2F0dHJp
YnV0ZT4KKworICAgICAgPGF0dHJpYnV0ZSBuYW1lPSJ0aHJlc2hvbGQiIHJlcXVpcmVkPSJmYWxz
ZSI+CisgICAgICAgIDxwPk1pbmltdW0gZHVyYXRpb24gaW4gc2Vjb25kcyBhZnRlciB3aGljaCBh
IHRocmVhZCBpcyBjb25zaWRlcmVkIHN0dWNrLgorICAgICAgICBEZWZhdWx0IGlzIDYwMCBzZWNv
bmRzLiBJZiBzZXQgdG8gMCwgdGhlIGRldGVjdGlvbiBpcyBkaXNhYmxlZC48L3A+CisgICAgICAg
IDxwPk5vdGU6IHNpbmNlIHRoZSBkZXRlY3Rpb24gaXMgZG9uZSBpbiB0aGUgYmFja2dyb3VuZCB0
aHJlYWQgb2YgdGhlIENvbnRhaW5lcgorICAgICAgICAoRW5naW5lLCBIb3N0IG9yIENvbnRleHQp
IGRlY2xhcmluZyB0aGlzIFZhbHZlLCB0aGUgdGhyZXNob2xkIHNob3VsZCBiZSBoaWdoZXIKKyAg
ICAgICAgdGhhbiB0aGUgPGNvZGU+YmFja2dyb3VuZFByb2Nlc3NvckRlbGF5PC9jb2RlPiBvZiB0
aGlzIENvbnRhaW5lci48L3A+CisgICAgICA8L2F0dHJpYnV0ZT4KKworICAgIDwvYXR0cmlidXRl
cz4KKworICA8L3N1YnNlY3Rpb24+CisKKzwvc2VjdGlvbj4KKworCiA8L2JvZHk+CiAKIAo=
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>28966</attachid>
            <date>2012-06-20 09:06:00 +0000</date>
            <delta_ts>2012-06-20 09:06:47 +0000</delta_ts>
            <desc>2012-06-20_tc6_50306_StuckThreadDetectionValve.patch</desc>
            <filename>2012-06-20_tc6_50306_StuckThreadDetectionValve.patch</filename>
            <type>text/plain</type>
            <size>16148</size>
            <attacher name="Konstantin Kolinko">knst.kolinko</attacher>
            
              <data encoding="base64">SW5kZXg6IGphdmEvb3JnL2FwYWNoZS9jYXRhbGluYS92YWx2ZXMvTG9jYWxTdHJpbmdzLnByb3Bl
cnRpZXMNCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT0NCi0tLSBqYXZhL29yZy9hcGFjaGUvY2F0YWxpbmEvdmFsdmVzL0xv
Y2FsU3RyaW5ncy5wcm9wZXJ0aWVzCShyZXZpc2lvbiAxMzUxNjAxKQ0KKysrIGphdmEvb3JnL2Fw
YWNoZS9jYXRhbGluYS92YWx2ZXMvTG9jYWxTdHJpbmdzLnByb3BlcnRpZXMJKHdvcmtpbmcgY29w
eSkNCkBAIC01Niw2ICs1NiwxMCBAQA0KIAogc3NsVmFsdmUuaW52YWxpZFByb3ZpZGVyPVRoZSBT
U0wgcHJvdmlkZXIgc3BlY2lmaWVkIG9uIHRoZSBjb25uZWN0b3IgYXNzb2NpYXRlZCB3aXRoIHRo
aXMgcmVxdWVzdCBvZiBbezB9XSBpcyBpbnZhbGlkLiBUaGUgY2VydGlmaWNhdGUgZGF0YSBjb3Vs
ZCBub3QgYmUgcHJvY2Vzc2VkLgogCisjU3R1Y2sgdGhyZWFkIGRldGVjdGlvbiBWYWx2ZQorc3R1
Y2tUaHJlYWREZXRlY3Rpb25WYWx2ZS5ub3RpZnlTdHVja1RocmVhZERldGVjdGVkPVRocmVhZCAi
ezB9IiAoaWQ9ezZ9KSBoYXMgYmVlbiBhY3RpdmUgZm9yIHsxfSBtaWxsaXNlY29uZHMgKHNpbmNl
IHsyfSkgdG8gc2VydmUgdGhlIHNhbWUgcmVxdWVzdCBmb3IgezR9IGFuZCBtYXkgYmUgc3R1Y2sg
KGNvbmZpZ3VyZWQgdGhyZXNob2xkIGZvciB0aGlzIFN0dWNrVGhyZWFkRGV0ZWN0aW9uVmFsdmUg
aXMgezV9IHNlY29uZHMpLiBUaGVyZSBpcy9hcmUgezN9IHRocmVhZChzKSBpbiB0b3RhbCB0aGF0
IGFyZSBtb25pdG9yZWQgYnkgdGhpcyBWYWx2ZSBhbmQgbWF5IGJlIHN0dWNrLgorc3R1Y2tUaHJl
YWREZXRlY3Rpb25WYWx2ZS5ub3RpZnlTdHVja1RocmVhZENvbXBsZXRlZD1UaHJlYWQgInswfSIg
KGlkPXszfSkgd2FzIHByZXZpb3VzbHkgcmVwb3J0ZWQgdG8gYmUgc3R1Y2sgYnV0IGhhcyBjb21w
bGV0ZWQuIEl0IHdhcyBhY3RpdmUgZm9yIGFwcHJveGltYXRlbHkgezF9IG1pbGxpc2Vjb25kcy57
MixjaG9pY2UsMCN8MDwgVGhlcmUgaXMvYXJlIHN0aWxsIHsyfSB0aHJlYWQocykgdGhhdCBhcmUg
bW9uaXRvcmVkIGJ5IHRoaXMgVmFsdmUgYW5kIG1heSBiZSBzdHVjay59CisKICMgSFRUUCBzdGF0
dXMgcmVwb3J0cwogaHR0cC4xMDA9VGhlIGNsaWVudCBtYXkgY29udGludWUgKHswfSkuCiBodHRw
LjEwMT1UaGUgc2VydmVyIGlzIHN3aXRjaGluZyBwcm90b2NvbHMgYWNjb3JkaW5nIHRvIHRoZSAi
VXBncmFkZSIgaGVhZGVyICh7MH0pLgpJbmRleDogamF2YS9vcmcvYXBhY2hlL2NhdGFsaW5hL3Zh
bHZlcy9tYmVhbnMtZGVzY3JpcHRvcnMueG1sDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLS0gamF2YS9vcmcvYXBh
Y2hlL2NhdGFsaW5hL3ZhbHZlcy9tYmVhbnMtZGVzY3JpcHRvcnMueG1sCShyZXZpc2lvbiAxMzUx
NjAxKQ0KKysrIGphdmEvb3JnL2FwYWNoZS9jYXRhbGluYS92YWx2ZXMvbWJlYW5zLWRlc2NyaXB0
b3JzLnhtbAkod29ya2luZyBjb3B5KQ0KQEAgLTQ1OSw0ICs0NTksMzEgQEANCiAgICAgICAgICAg
ICAgICB3cml0ZWFibGU9ImZhbHNlIiAvPgogICAgICAgICAgICAgICAgCiAgIDwvbWJlYW4+CisK
KyAgPG1iZWFuIG5hbWU9IlN0dWNrVGhyZWFkRGV0ZWN0aW9uVmFsdmUiCisgICAgICAgICBkZXNj
cmlwdGlvbj0iRGV0ZWN0IGxvbmcgcmVxdWVzdHMgZm9yIHdoaWNoIHRoZWlyIHRocmVhZCBtaWdo
dCBiZSBzdHVjayIKKyAgICAgICAgIGRvbWFpbj0iQ2F0YWxpbmEiCisgICAgICAgICBncm91cD0i
VmFsdmUiCisgICAgICAgICB0eXBlPSJvcmcuYXBhY2hlLmNhdGFsaW5hLnZhbHZlcy5TdHVja1Ro
cmVhZERldGVjdGlvblZhbHZlIj4KKworICAgIDxhdHRyaWJ1dGUgbmFtZT0iY2xhc3NOYW1lIgor
ICAgICAgICAgICAgICAgZGVzY3JpcHRpb249IkZ1bGx5IHF1YWxpZmllZCBjbGFzcyBuYW1lIG9m
IHRoZSBtYW5hZ2VkIG9iamVjdCIKKyAgICAgICAgICAgICAgIHR5cGU9ImphdmEubGFuZy5TdHJp
bmciCisgICAgICAgICAgICAgICB3cml0ZWFibGU9ImZhbHNlIi8+CisKKyAgICA8YXR0cmlidXRl
IG5hbWU9InN0dWNrVGhyZWFkSWRzIgorICAgICAgICAgICAgICAgZGVzY3JpcHRpb249IklEcyBv
ZiB0aGUgdGhyZWFkcyBjdXJyZW50bHkgY29uc2lkZXJlZCBzdHVjay4gRWFjaCBJRCBjYW4gdGhl
biBiZSB1c2VkIHdpdGggdGhlIFRocmVhZGluZyBNQmVhbiB0byByZXRyaWV2ZSBkYXRhIGFib3V0
IGl0LiIKKyAgICAgICAgICAgICAgIHR5cGU9ImxvbmdbXSIKKyAgICAgICAgICAgICAgIHdyaXRl
YWJsZT0iZmFsc2UiLz4KKworICAgIDxhdHRyaWJ1dGUgbmFtZT0ic3R1Y2tUaHJlYWROYW1lcyIK
KyAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJOYW1lcyBvZiB0aGUgdGhyZWFkcyBjdXJyZW50
bHkgY29uc2lkZXJlZCBzdHVjay4iCisgICAgICAgICAgICAgICB0eXBlPSJqYXZhLmxhbmcuU3Ry
aW5nW10iCisgICAgICAgICAgICAgICB3cml0ZWFibGU9ImZhbHNlIi8+CisKKyAgICA8YXR0cmli
dXRlIG5hbWU9InRocmVzaG9sZCIKKyAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJEdXJhdGlv
biBpbiBzZWNvbmRzIGFmdGVyIHdoaWNoIGEgcmVxdWVzdCBpcyBjb25zaWRlcmVkIGFzIHN0dWNr
IgorICAgICAgICAgICAgICAgdHlwZT0iaW50Ii8+CisKKyAgPC9tYmVhbj4KIDwvbWJlYW5zLWRl
c2NyaXB0b3JzPgpJbmRleDogamF2YS9vcmcvYXBhY2hlL2NhdGFsaW5hL3ZhbHZlcy9TdHVja1Ro
cmVhZERldGVjdGlvblZhbHZlLmphdmENCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSBqYXZhL29yZy9hcGFjaGUv
Y2F0YWxpbmEvdmFsdmVzL1N0dWNrVGhyZWFkRGV0ZWN0aW9uVmFsdmUuamF2YQkocmV2aXNpb24g
MCkNCisrKyBqYXZhL29yZy9hcGFjaGUvY2F0YWxpbmEvdmFsdmVzL1N0dWNrVGhyZWFkRGV0ZWN0
aW9uVmFsdmUuamF2YQkod29ya2luZyBjb3B5KQ0KQEAgLTAsMCArMSwyOTcgQEANCisvKgorICog
TGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9u
ZSBvciBtb3JlCisgKiBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5P
VElDRSBmaWxlIGRpc3RyaWJ1dGVkIHdpdGgKKyAqIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBp
bmZvcm1hdGlvbiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4KKyAqIFRoZSBBU0YgbGlj
ZW5zZXMgdGhpcyBmaWxlIHRvIFlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24g
Mi4wCisgKiAodGhlICJMaWNlbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0
IGluIGNvbXBsaWFuY2Ugd2l0aAorICogdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv
cHkgb2YgdGhlIExpY2Vuc2UgYXQKKyAqCisgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9s
aWNlbnNlcy9MSUNFTlNFLTIuMAorICoKKyAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxl
IGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKKyAqIGRpc3RyaWJ1dGVkIHVu
ZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCisgKiBX
SVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJl
c3Mgb3IgaW1wbGllZC4KKyAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1
YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKKyAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBM
aWNlbnNlLgorICovCitwYWNrYWdlIG9yZy5hcGFjaGUuY2F0YWxpbmEudmFsdmVzOworCitpbXBv
cnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKK2ltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OworaW1w
b3J0IGphdmEudXRpbC5EYXRlOworaW1wb3J0IGphdmEudXRpbC5MaXN0OworaW1wb3J0IGphdmEu
dXRpbC5RdWV1ZTsKK2ltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50SGFzaE1h
cDsKK2ltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50TGlua2VkUXVldWU7Citp
bXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21pY0ludGVnZXI7CisKK2ltcG9y
dCBqYXZheC5zZXJ2bGV0LlNlcnZsZXRFeGNlcHRpb247CisKK2ltcG9ydCBvcmcuYXBhY2hlLmNh
dGFsaW5hLmNvbm5lY3Rvci5SZXF1ZXN0OworaW1wb3J0IG9yZy5hcGFjaGUuY2F0YWxpbmEuY29u
bmVjdG9yLlJlc3BvbnNlOworaW1wb3J0IG9yZy5hcGFjaGUuanVsaS5sb2dnaW5nLkxvZzsKK2lt
cG9ydCBvcmcuYXBhY2hlLmp1bGkubG9nZ2luZy5Mb2dGYWN0b3J5OworaW1wb3J0IG9yZy5hcGFj
aGUudG9tY2F0LnV0aWwucmVzLlN0cmluZ01hbmFnZXI7CisKKy8qKgorICogVGhpcyB2YWx2ZSBh
bGxvd3MgdG8gZGV0ZWN0IHJlcXVlc3RzIHRoYXQgdGFrZSBhIGxvbmcgdGltZSB0byBwcm9jZXNz
LCB3aGljaAorICogbWlnaHQgaW5kaWNhdGUgdGhhdCB0aGUgdGhyZWFkIHRoYXQgaXMgcHJvY2Vz
c2luZyBpdCBpcyBzdHVjay4KKyAqLworcHVibGljIGNsYXNzIFN0dWNrVGhyZWFkRGV0ZWN0aW9u
VmFsdmUgZXh0ZW5kcyBWYWx2ZUJhc2UgeworCisgICAgLyoqCisgICAgICogTG9nZ2VyCisgICAg
ICovCisgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nIGxvZyA9IExvZ0ZhY3RvcnkuZ2V0TG9n
KFN0dWNrVGhyZWFkRGV0ZWN0aW9uVmFsdmUuY2xhc3MpOworCisgICAgLyoqCisgICAgICogVGhl
IHN0cmluZyBtYW5hZ2VyIGZvciB0aGlzIHBhY2thZ2UuCisgICAgICovCisgICAgcHJpdmF0ZSBz
dGF0aWMgZmluYWwgU3RyaW5nTWFuYWdlciBzbSA9CisgICAgICAgIFN0cmluZ01hbmFnZXIuZ2V0
TWFuYWdlcihDb25zdGFudHMuUGFja2FnZSk7CisKKyAgICAvKioKKyAgICAgKiBLZWVwcyBjb3Vu
dCBvZiB0aGUgbnVtYmVyIG9mIHN0dWNrIHRocmVhZHMgZGV0ZWN0ZWQKKyAgICAgKi8KKyAgICBw
cml2YXRlIGZpbmFsIEF0b21pY0ludGVnZXIgc3R1Y2tDb3VudCA9IG5ldyBBdG9taWNJbnRlZ2Vy
KDApOworCisgICAgLyoqCisgICAgICogSW4gc2Vjb25kcy4gRGVmYXVsdCA2MDAgKDEwIG1pbnV0
ZXMpLgorICAgICAqLworICAgIHByaXZhdGUgaW50IHRocmVzaG9sZCA9IDYwMDsKKworICAgIC8q
KgorICAgICAqIFRoZSBvbmx5IHJlZmVyZW5jZXMgd2Uga2VlcCB0byBhY3R1YWwgcnVubmluZyBU
aHJlYWQgb2JqZWN0cyBhcmUgaW4KKyAgICAgKiB0aGlzIE1hcCAod2hpY2ggaXMgYXV0b21hdGlj
YWxseSBjbGVhbmVkIGluIGludm9rZSgpcyBmaW5hbGx5IGNsYXVzZSkuCisgICAgICogVGhhdCB3
YXksIFRocmVhZHMgY2FuIGJlIEdDJ2VkLCBldmVudGhvdWdoIHRoZSBWYWx2ZSBzdGlsbCB0aGlu
a3MgdGhleQorICAgICAqIGFyZSBzdHVjayAoY2F1c2VkIGJ5IGEgbG9uZyBtb25pdG9yIGludGVy
dmFsKQorICAgICAqLworICAgIHByaXZhdGUgZmluYWwgQ29uY3VycmVudEhhc2hNYXA8TG9uZywg
TW9uaXRvcmVkVGhyZWFkPiBhY3RpdmVUaHJlYWRzID0KKyAgICAgICAgICAgIG5ldyBDb25jdXJy
ZW50SGFzaE1hcDxMb25nLCBNb25pdG9yZWRUaHJlYWQ+KCk7CisgICAgLyoqCisgICAgICoKKyAg
ICAgKi8KKyAgICBwcml2YXRlIGZpbmFsIFF1ZXVlPENvbXBsZXRlZFN0dWNrVGhyZWFkPiBjb21w
bGV0ZWRTdHVja1RocmVhZHNRdWV1ZSA9CisgICAgICAgICAgICBuZXcgQ29uY3VycmVudExpbmtl
ZFF1ZXVlPENvbXBsZXRlZFN0dWNrVGhyZWFkPigpOworCisgICAgLyoqCisgICAgICogU3BlY2lm
eSB0aGUgdGhyZXNob2xkIChpbiBzZWNvbmRzKSB1c2VkIHdoZW4gY2hlY2tpbmcgZm9yIHN0dWNr
IHRocmVhZHMuCisgICAgICogSWYgJmx0Oz0wLCB0aGUgZGV0ZWN0aW9uIGlzIGRpc2FibGVkLiBU
aGUgZGVmYXVsdCBpcyA2MDAgc2Vjb25kcy4KKyAgICAgKgorICAgICAqIEBwYXJhbSB0aHJlc2hv
bGQKKyAgICAgKiAgICAgICAgICAgIFRoZSBuZXcgdGhyZXNob2xkIGluIHNlY29uZHMKKyAgICAg
Ki8KKyAgICBwdWJsaWMgdm9pZCBzZXRUaHJlc2hvbGQoaW50IHRocmVzaG9sZCkgeworICAgICAg
ICB0aGlzLnRocmVzaG9sZCA9IHRocmVzaG9sZDsKKyAgICB9CisKKyAgICAvKioKKyAgICAgKiBA
c2VlICNzZXRUaHJlc2hvbGQoaW50KQorICAgICAqIEByZXR1cm4gVGhlIGN1cnJlbnQgdGhyZXNo
b2xkIGluIHNlY29uZHMKKyAgICAgKi8KKyAgICBwdWJsaWMgaW50IGdldFRocmVzaG9sZCgpIHsK
KyAgICAgICAgcmV0dXJuIHRocmVzaG9sZDsKKyAgICB9CisKKworICAgIHByaXZhdGUgdm9pZCBu
b3RpZnlTdHVja1RocmVhZERldGVjdGVkKE1vbml0b3JlZFRocmVhZCBtb25pdG9yZWRUaHJlYWQs
CisgICAgICAgIGxvbmcgYWN0aXZlVGltZSwgaW50IG51bVN0dWNrVGhyZWFkcykgeworICAgICAg
ICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkgeworICAgICAgICAgICAgU3RyaW5nIG1zZyA9IHNt
LmdldFN0cmluZygKKyAgICAgICAgICAgICAgICAic3R1Y2tUaHJlYWREZXRlY3Rpb25WYWx2ZS5u
b3RpZnlTdHVja1RocmVhZERldGVjdGVkIiwKKyAgICAgICAgICAgICAgICBtb25pdG9yZWRUaHJl
YWQuZ2V0VGhyZWFkKCkuZ2V0TmFtZSgpLAorICAgICAgICAgICAgICAgIExvbmcudmFsdWVPZihh
Y3RpdmVUaW1lKSwKKyAgICAgICAgICAgICAgICBtb25pdG9yZWRUaHJlYWQuZ2V0U3RhcnRUaW1l
KCksCisgICAgICAgICAgICAgICAgSW50ZWdlci52YWx1ZU9mKG51bVN0dWNrVGhyZWFkcyksCisg
ICAgICAgICAgICAgICAgbW9uaXRvcmVkVGhyZWFkLmdldFJlcXVlc3RVcmkoKSwKKyAgICAgICAg
ICAgICAgICBJbnRlZ2VyLnZhbHVlT2YodGhyZXNob2xkKSwKKyAgICAgICAgICAgICAgICBTdHJp
bmcudmFsdWVPZihtb25pdG9yZWRUaHJlYWQuZ2V0VGhyZWFkKCkuZ2V0SWQoKSkKKyAgICAgICAg
ICAgICAgICApOworICAgICAgICAgICAgLy8gbXNnICs9ICJcbiIgKyBnZXRTdGFja1RyYWNlQXNT
dHJpbmcodHJhY2UpOworICAgICAgICAgICAgVGhyb3dhYmxlIHRoID0gbmV3IFRocm93YWJsZSgp
OworICAgICAgICAgICAgdGguc2V0U3RhY2tUcmFjZShtb25pdG9yZWRUaHJlYWQuZ2V0VGhyZWFk
KCkuZ2V0U3RhY2tUcmFjZSgpKTsKKyAgICAgICAgICAgIGxvZy53YXJuKG1zZywgdGgpOworICAg
ICAgICB9CisgICAgfQorCisgICAgcHJpdmF0ZSB2b2lkIG5vdGlmeVN0dWNrVGhyZWFkQ29tcGxl
dGVkKENvbXBsZXRlZFN0dWNrVGhyZWFkIHRocmVhZCwKKyAgICAgICAgICAgIGludCBudW1TdHVj
a1RocmVhZHMpIHsKKyAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpIHsKKyAgICAgICAg
ICAgIFN0cmluZyBtc2cgPSBzbS5nZXRTdHJpbmcoCisgICAgICAgICAgICAgICAgInN0dWNrVGhy
ZWFkRGV0ZWN0aW9uVmFsdmUubm90aWZ5U3R1Y2tUaHJlYWRDb21wbGV0ZWQiLAorICAgICAgICAg
ICAgICAgIHRocmVhZC5nZXROYW1lKCksCisgICAgICAgICAgICAgICAgTG9uZy52YWx1ZU9mKHRo
cmVhZC5nZXRUb3RhbEFjdGl2ZVRpbWUoKSksCisgICAgICAgICAgICAgICAgSW50ZWdlci52YWx1
ZU9mKG51bVN0dWNrVGhyZWFkcyksCisgICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVlT2YodGhy
ZWFkLmdldElkKCkpKTsKKyAgICAgICAgICAgIC8vIFNpbmNlIHRoZSAic3R1Y2sgdGhyZWFkIG5v
dGlmaWNhdGlvbiIgaXMgd2FybiwgdGhpcyBzaG91bGQgYWxzbworICAgICAgICAgICAgLy8gYmUg
d2FybgorICAgICAgICAgICAgbG9nLndhcm4obXNnKTsKKyAgICAgICAgfQorICAgIH0KKworICAg
IC8qKgorICAgICAqIHtAaW5oZXJpdERvY30KKyAgICAgKi8KKyAgICBAT3ZlcnJpZGUKKyAgICBw
dWJsaWMgdm9pZCBpbnZva2UoUmVxdWVzdCByZXF1ZXN0LCBSZXNwb25zZSByZXNwb25zZSkKKyAg
ICAgICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgU2VydmxldEV4Y2VwdGlvbiB7CisKKyAgICAg
ICAgaWYgKHRocmVzaG9sZCA8PSAwKSB7CisgICAgICAgICAgICAvLyBzaG9ydC1jaXJjdWl0IGlm
IG5vdCBtb25pdG9yaW5nIHN0dWNrIHRocmVhZHMKKyAgICAgICAgICAgIGdldE5leHQoKS5pbnZv
a2UocmVxdWVzdCwgcmVzcG9uc2UpOworICAgICAgICAgICAgcmV0dXJuOworICAgICAgICB9CisK
KyAgICAgICAgLy8gU2F2ZSB0aGUgdGhyZWFkL3J1bm5hYmxlCisgICAgICAgIC8vIEtlZXBpbmcg
YSByZWZlcmVuY2UgdG8gdGhlIHRocmVhZCBvYmplY3QgaGVyZSBkb2VzIG5vdCBwcmV2ZW50Cisg
ICAgICAgIC8vIEdDJ2luZywgYXMgdGhlIHJlZmVyZW5jZSBpcyByZW1vdmVkIGZyb20gdGhlIE1h
cCBpbiB0aGUgZmluYWxseSBjbGF1c2UKKworICAgICAgICBMb25nIGtleSA9IExvbmcudmFsdWVP
ZihUaHJlYWQuY3VycmVudFRocmVhZCgpLmdldElkKCkpOworICAgICAgICBTdHJpbmdCdWZmZXIg
cmVxdWVzdFVybCA9IHJlcXVlc3QuZ2V0UmVxdWVzdFVSTCgpOworICAgICAgICBpZihyZXF1ZXN0
LmdldFF1ZXJ5U3RyaW5nKCkhPW51bGwpIHsKKyAgICAgICAgICAgIHJlcXVlc3RVcmwuYXBwZW5k
KCI/Iik7CisgICAgICAgICAgICByZXF1ZXN0VXJsLmFwcGVuZChyZXF1ZXN0LmdldFF1ZXJ5U3Ry
aW5nKCkpOworICAgICAgICB9CisgICAgICAgIE1vbml0b3JlZFRocmVhZCBtb25pdG9yZWRUaHJl
YWQgPSBuZXcgTW9uaXRvcmVkVGhyZWFkKFRocmVhZC5jdXJyZW50VGhyZWFkKCksCisgICAgICAg
ICAgICByZXF1ZXN0VXJsLnRvU3RyaW5nKCkpOworICAgICAgICBhY3RpdmVUaHJlYWRzLnB1dChr
ZXksIG1vbml0b3JlZFRocmVhZCk7CisKKyAgICAgICAgdHJ5IHsKKyAgICAgICAgICAgIGdldE5l
eHQoKS5pbnZva2UocmVxdWVzdCwgcmVzcG9uc2UpOworICAgICAgICB9IGZpbmFsbHkgeworICAg
ICAgICAgICAgYWN0aXZlVGhyZWFkcy5yZW1vdmUoa2V5KTsKKyAgICAgICAgICAgIGlmIChtb25p
dG9yZWRUaHJlYWQubWFya0FzRG9uZSgpID09IE1vbml0b3JlZFRocmVhZFN0YXRlLlNUVUNLKSB7
CisgICAgICAgICAgICAgICAgY29tcGxldGVkU3R1Y2tUaHJlYWRzUXVldWUuYWRkKAorICAgICAg
ICAgICAgICAgICAgICAgICAgbmV3IENvbXBsZXRlZFN0dWNrVGhyZWFkKG1vbml0b3JlZFRocmVh
ZC5nZXRUaHJlYWQoKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb25pdG9yZWRUaHJl
YWQuZ2V0QWN0aXZlVGltZUluTWlsbGlzKCkpKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfQor
ICAgIH0KKworICAgIEBPdmVycmlkZQorICAgIHB1YmxpYyB2b2lkIGJhY2tncm91bmRQcm9jZXNz
KCkgeworICAgICAgICBzdXBlci5iYWNrZ3JvdW5kUHJvY2VzcygpOworCisgICAgICAgIGxvbmcg
dGhyZXNob2xkSW5NaWxsaXMgPSB0aHJlc2hvbGQgKiAxMDAwOworCisgICAgICAgIC8vIENoZWNr
IG1vbml0b3JlZCB0aHJlYWRzLCBiZWluZyBjYXJlZnVsIHRoYXQgdGhlIHJlcXVlc3QgbWlnaHQg
aGF2ZQorICAgICAgICAvLyBjb21wbGV0ZWQgYnkgdGhlIHRpbWUgd2UgZXhhbWluZSBpdAorICAg
ICAgICBmb3IgKE1vbml0b3JlZFRocmVhZCBtb25pdG9yZWRUaHJlYWQgOiBhY3RpdmVUaHJlYWRz
LnZhbHVlcygpKSB7CisgICAgICAgICAgICBsb25nIGFjdGl2ZVRpbWUgPSBtb25pdG9yZWRUaHJl
YWQuZ2V0QWN0aXZlVGltZUluTWlsbGlzKCk7CisKKyAgICAgICAgICAgIGlmIChhY3RpdmVUaW1l
ID49IHRocmVzaG9sZEluTWlsbGlzICYmIG1vbml0b3JlZFRocmVhZC5tYXJrQXNTdHVja0lmU3Rp
bGxSdW5uaW5nKCkpIHsKKyAgICAgICAgICAgICAgICBpbnQgbnVtU3R1Y2tUaHJlYWRzID0gc3R1
Y2tDb3VudC5pbmNyZW1lbnRBbmRHZXQoKTsKKyAgICAgICAgICAgICAgICBub3RpZnlTdHVja1Ro
cmVhZERldGVjdGVkKG1vbml0b3JlZFRocmVhZCwgYWN0aXZlVGltZSwgbnVtU3R1Y2tUaHJlYWRz
KTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfQorICAgICAgICAvLyBDaGVjayBpZiBhbnkgdGhy
ZWFkcyBwcmV2aW91c2x5IHJlcG9ydGVkIGFzIHN0dWNrLCBoYXZlIGZpbmlzaGVkLgorICAgICAg
ICBmb3IgKENvbXBsZXRlZFN0dWNrVGhyZWFkIGNvbXBsZXRlZFN0dWNrVGhyZWFkID0gY29tcGxl
dGVkU3R1Y2tUaHJlYWRzUXVldWUucG9sbCgpOworICAgICAgICAgICAgY29tcGxldGVkU3R1Y2tU
aHJlYWQgIT0gbnVsbDsgY29tcGxldGVkU3R1Y2tUaHJlYWQgPSBjb21wbGV0ZWRTdHVja1RocmVh
ZHNRdWV1ZS5wb2xsKCkpIHsKKworICAgICAgICAgICAgaW50IG51bVN0dWNrVGhyZWFkcyA9IHN0
dWNrQ291bnQuZGVjcmVtZW50QW5kR2V0KCk7CisgICAgICAgICAgICBub3RpZnlTdHVja1RocmVh
ZENvbXBsZXRlZChjb21wbGV0ZWRTdHVja1RocmVhZCwgbnVtU3R1Y2tUaHJlYWRzKTsKKyAgICAg
ICAgfQorICAgIH0KKworICAgIHB1YmxpYyBsb25nW10gZ2V0U3R1Y2tUaHJlYWRJZHMoKSB7Cisg
ICAgICAgIExpc3Q8TG9uZz4gaWRMaXN0ID0gbmV3IEFycmF5TGlzdDxMb25nPigpOworICAgICAg
ICBmb3IgKE1vbml0b3JlZFRocmVhZCBtb25pdG9yZWRUaHJlYWQgOiBhY3RpdmVUaHJlYWRzLnZh
bHVlcygpKSB7CisgICAgICAgICAgICBpZiAobW9uaXRvcmVkVGhyZWFkLmlzTWFya2VkQXNTdHVj
aygpKSB7CisgICAgICAgICAgICAgICAgaWRMaXN0LmFkZChMb25nLnZhbHVlT2YobW9uaXRvcmVk
VGhyZWFkLmdldFRocmVhZCgpLmdldElkKCkpKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfQor
CisgICAgICAgIGxvbmdbXSByZXN1bHQgPSBuZXcgbG9uZ1tpZExpc3Quc2l6ZSgpXTsKKyAgICAg
ICAgZm9yIChpbnQgaSA9IDA7IGkgPCByZXN1bHQubGVuZ3RoOyBpKyspIHsKKyAgICAgICAgICAg
IHJlc3VsdFtpXSA9IGlkTGlzdC5nZXQoaSkubG9uZ1ZhbHVlKCk7CisgICAgICAgIH0KKyAgICAg
ICAgcmV0dXJuIHJlc3VsdDsKKyAgICB9CisKKyAgICBwdWJsaWMgU3RyaW5nW10gZ2V0U3R1Y2tU
aHJlYWROYW1lcygpIHsKKyAgICAgICAgTGlzdDxTdHJpbmc+IG5hbWVMaXN0ID0gbmV3IEFycmF5
TGlzdDxTdHJpbmc+KCk7CisgICAgICAgIGZvciAoTW9uaXRvcmVkVGhyZWFkIG1vbml0b3JlZFRo
cmVhZCA6IGFjdGl2ZVRocmVhZHMudmFsdWVzKCkpIHsKKyAgICAgICAgICAgIGlmIChtb25pdG9y
ZWRUaHJlYWQuaXNNYXJrZWRBc1N0dWNrKCkpIHsKKyAgICAgICAgICAgICAgICBuYW1lTGlzdC5h
ZGQobW9uaXRvcmVkVGhyZWFkLmdldFRocmVhZCgpLmdldE5hbWUoKSk7CisgICAgICAgICAgICB9
CisgICAgICAgIH0KKyAgICAgICAgcmV0dXJuIG5hbWVMaXN0LnRvQXJyYXkobmV3IFN0cmluZ1tu
YW1lTGlzdC5zaXplKCldKTsKKyAgICB9CisKKyAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBNb25p
dG9yZWRUaHJlYWQgeworCisgICAgICAgIC8qKgorICAgICAgICAgKiBSZWZlcmVuY2UgdG8gdGhl
IHRocmVhZCB0byBnZXQgYSBzdGFjayB0cmFjZSBmcm9tIGJhY2tncm91bmQgdGFzaworICAgICAg
ICAgKi8KKyAgICAgICAgcHJpdmF0ZSBmaW5hbCBUaHJlYWQgdGhyZWFkOworICAgICAgICBwcml2
YXRlIGZpbmFsIFN0cmluZyByZXF1ZXN0VXJpOworICAgICAgICBwcml2YXRlIGZpbmFsIGxvbmcg
c3RhcnQ7CisgICAgICAgIHByaXZhdGUgZmluYWwgQXRvbWljSW50ZWdlciBzdGF0ZSA9IG5ldyBB
dG9taWNJbnRlZ2VyKAorICAgICAgICAgICAgTW9uaXRvcmVkVGhyZWFkU3RhdGUuUlVOTklORy5v
cmRpbmFsKCkpOworCisgICAgICAgIHB1YmxpYyBNb25pdG9yZWRUaHJlYWQoVGhyZWFkIHRocmVh
ZCwgU3RyaW5nIHJlcXVlc3RVcmkpIHsKKyAgICAgICAgICAgIHRoaXMudGhyZWFkID0gdGhyZWFk
OworICAgICAgICAgICAgdGhpcy5yZXF1ZXN0VXJpID0gcmVxdWVzdFVyaTsKKyAgICAgICAgICAg
IHRoaXMuc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKKyAgICAgICAgfQorCisg
ICAgICAgIHB1YmxpYyBUaHJlYWQgZ2V0VGhyZWFkKCkgeworICAgICAgICAgICAgcmV0dXJuIHRo
aXMudGhyZWFkOworICAgICAgICB9CisKKyAgICAgICAgcHVibGljIFN0cmluZyBnZXRSZXF1ZXN0
VXJpKCkgeworICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RVcmk7CisgICAgICAgIH0KKworICAg
ICAgICBwdWJsaWMgbG9uZyBnZXRBY3RpdmVUaW1lSW5NaWxsaXMoKSB7CisgICAgICAgICAgICBy
ZXR1cm4gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkgLSBzdGFydDsKKyAgICAgICAgfQorCisg
ICAgICAgIHB1YmxpYyBEYXRlIGdldFN0YXJ0VGltZSgpIHsKKyAgICAgICAgICAgIHJldHVybiBu
ZXcgRGF0ZShzdGFydCk7CisgICAgICAgIH0KKworICAgICAgICBwdWJsaWMgYm9vbGVhbiBtYXJr
QXNTdHVja0lmU3RpbGxSdW5uaW5nKCkgeworICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUu
Y29tcGFyZUFuZFNldChNb25pdG9yZWRUaHJlYWRTdGF0ZS5SVU5OSU5HLm9yZGluYWwoKSwKKyAg
ICAgICAgICAgICAgICBNb25pdG9yZWRUaHJlYWRTdGF0ZS5TVFVDSy5vcmRpbmFsKCkpOworICAg
ICAgICB9CisKKyAgICAgICAgcHVibGljIE1vbml0b3JlZFRocmVhZFN0YXRlIG1hcmtBc0RvbmUo
KSB7CisgICAgICAgICAgICBpbnQgdmFsID0gdGhpcy5zdGF0ZS5nZXRBbmRTZXQoTW9uaXRvcmVk
VGhyZWFkU3RhdGUuRE9ORS5vcmRpbmFsKCkpOworICAgICAgICAgICAgcmV0dXJuIE1vbml0b3Jl
ZFRocmVhZFN0YXRlLnZhbHVlcygpW3ZhbF07CisgICAgICAgIH0KKworICAgICAgICBib29sZWFu
IGlzTWFya2VkQXNTdHVjaygpIHsKKyAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLmdldCgp
ID09IE1vbml0b3JlZFRocmVhZFN0YXRlLlNUVUNLLm9yZGluYWwoKTsKKyAgICAgICAgfQorICAg
IH0KKworICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIENvbXBsZXRlZFN0dWNrVGhyZWFkIHsKKwor
ICAgICAgICBwcml2YXRlIGZpbmFsIFN0cmluZyB0aHJlYWROYW1lOworICAgICAgICBwcml2YXRl
IGZpbmFsIGxvbmcgdGhyZWFkSWQ7CisgICAgICAgIHByaXZhdGUgZmluYWwgbG9uZyB0b3RhbEFj
dGl2ZVRpbWU7CisKKyAgICAgICAgcHVibGljIENvbXBsZXRlZFN0dWNrVGhyZWFkKFRocmVhZCB0
aHJlYWQsIGxvbmcgdG90YWxBY3RpdmVUaW1lKSB7CisgICAgICAgICAgICB0aGlzLnRocmVhZE5h
bWUgPSB0aHJlYWQuZ2V0TmFtZSgpOworICAgICAgICAgICAgdGhpcy50aHJlYWRJZCA9IHRocmVh
ZC5nZXRJZCgpOworICAgICAgICAgICAgdGhpcy50b3RhbEFjdGl2ZVRpbWUgPSB0b3RhbEFjdGl2
ZVRpbWU7CisgICAgICAgIH0KKworICAgICAgICBwdWJsaWMgU3RyaW5nIGdldE5hbWUoKSB7Cisg
ICAgICAgICAgICByZXR1cm4gdGhpcy50aHJlYWROYW1lOworICAgICAgICB9CisKKyAgICAgICAg
cHVibGljIGxvbmcgZ2V0SWQoKSB7CisgICAgICAgICAgICByZXR1cm4gdGhpcy50aHJlYWRJZDsK
KyAgICAgICAgfQorCisgICAgICAgIHB1YmxpYyBsb25nIGdldFRvdGFsQWN0aXZlVGltZSgpIHsK
KyAgICAgICAgICAgIHJldHVybiB0aGlzLnRvdGFsQWN0aXZlVGltZTsKKyAgICAgICAgfQorICAg
IH0KKworICAgIHByaXZhdGUgZW51bSBNb25pdG9yZWRUaHJlYWRTdGF0ZSB7CisgICAgICAgIFJV
Tk5JTkcsIFNUVUNLLCBET05FOworICAgIH0KK30KSW5kZXg6IGphdmEvb3JnL2FwYWNoZS9jYXRh
bGluYS92YWx2ZXMvU3R1Y2tUaHJlYWREZXRlY3Rpb25WYWx2ZS5qYXZhDQo9PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQot
LS0gamF2YS9vcmcvYXBhY2hlL2NhdGFsaW5hL3ZhbHZlcy9TdHVja1RocmVhZERldGVjdGlvblZh
bHZlLmphdmEJKHJldmlzaW9uIDApDQorKysgamF2YS9vcmcvYXBhY2hlL2NhdGFsaW5hL3ZhbHZl
cy9TdHVja1RocmVhZERldGVjdGlvblZhbHZlLmphdmEJKHdvcmtpbmcgY29weSkNCg0KUHJvcGVy
dHkgY2hhbmdlcyBvbjogamF2YS9vcmcvYXBhY2hlL2NhdGFsaW5hL3ZhbHZlcy9TdHVja1RocmVh
ZERldGVjdGlvblZhbHZlLmphdmENCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18NCkFkZGVkOiBzdm46ZW9sLXN0eWxlDQoj
IyAtMCwwICsxICMjDQorbmF0aXZlDQpcIE5vIG5ld2xpbmUgYXQgZW5kIG9mIHByb3BlcnR5DQpJ
bmRleDogd2ViYXBwcy9kb2NzL2NvbmZpZy92YWx2ZS54bWwNCj09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLSB3ZWJh
cHBzL2RvY3MvY29uZmlnL3ZhbHZlLnhtbAkocmV2aXNpb24gMTM1MTYwMSkNCisrKyB3ZWJhcHBz
L2RvY3MvY29uZmlnL3ZhbHZlLnhtbAkod29ya2luZyBjb3B5KQ0KQEAgLTg3Myw2ICs4NzMsNTAg
QEANCiA8L3NlY3Rpb24+CiAKIAorPHNlY3Rpb24gbmFtZT0iU3R1Y2sgVGhyZWFkIERldGVjdGlv
biBWYWx2ZSI+CisKKyAgPHN1YnNlY3Rpb24gbmFtZT0iSW50cm9kdWN0aW9uIj4KKworICAgIDxw
PlRoaXMgdmFsdmUgYWxsb3dzIHRvIGRldGVjdCByZXF1ZXN0cyB0aGF0IHRha2UgYSBsb25nIHRp
bWUgdG8gcHJvY2Vzcywgd2hpY2ggbWlnaHQKKyAgICBpbmRpY2F0ZSB0aGF0IHRoZSB0aHJlYWQg
dGhhdCBpcyBwcm9jZXNzaW5nIGl0IGlzIHN0dWNrLjwvcD4KKyAgICA8cD5XaGVuIHN1Y2ggYSBy
ZXF1ZXN0IGlzIGRldGVjdGVkLCB0aGUgY3VycmVudCBzdGFjayB0cmFjZSBvZiBpdHMgdGhyZWFk
IGlzIHdyaXR0ZW4KKyAgICB0byBUb21jYXQgbG9nIHdpdGggYSBXQVJOIGxldmVsLjwvcD4KKyAg
ICA8cD5UaGUgSURzIGFuZCBuYW1lcyBvZiB0aGUgc3R1Y2sgdGhyZWFkcyBhcmUgYXZhaWxhYmxl
IHRocm91Z2ggSk1YIGluIHRoZQorICAgIDxjb2RlPnN0dWNrVGhyZWFkSWRzPC9jb2RlPiBhbmQg
PGNvZGU+c3R1Y2tUaHJlYWROYW1lczwvY29kZT4gYXR0cmlidXRlcy4KKyAgICBUaGUgSURzIGNh
biBiZSB1c2VkIHdpdGggdGhlIHN0YW5kYXJkIFRocmVhZGluZyBKVk0gTUJlYW4KKyAgICAoPGNv
ZGU+amF2YS5sYW5nOnR5cGU9VGhyZWFkaW5nPC9jb2RlPikgdG8gcmV0cmlldmUgb3RoZXIgaW5m
b3JtYXRpb24KKyAgICBhYm91dCBlYWNoIHN0dWNrIHRocmVhZC48L3A+CisKKyAgPC9zdWJzZWN0
aW9uPgorCisgIDxzdWJzZWN0aW9uIG5hbWU9IkF0dHJpYnV0ZXMiPgorCisgICAgPHA+VGhlIDxz
dHJvbmc+U3R1Y2sgVGhyZWFkIERldGVjdGlvbiBWYWx2ZTwvc3Ryb25nPiBzdXBwb3J0cyB0aGUK
KyAgICBmb2xsb3dpbmcgY29uZmlndXJhdGlvbiBhdHRyaWJ1dGVzOjwvcD4KKworICAgIDxhdHRy
aWJ1dGVzPgorCisgICAgICA8YXR0cmlidXRlIG5hbWU9ImNsYXNzTmFtZSIgcmVxdWlyZWQ9InRy
dWUiPgorICAgICAgICA8cD5KYXZhIGNsYXNzIG5hbWUgb2YgdGhlIGltcGxlbWVudGF0aW9uIHRv
IHVzZS4gIFRoaXMgTVVTVCBiZSBzZXQgdG8KKyAgICAgICAgPHN0cm9uZz5vcmcuYXBhY2hlLmNh
dGFsaW5hLnZhbHZlcy5TdHVja1RocmVhZERldGVjdGlvblZhbHZlPC9zdHJvbmc+LgorICAgICAg
ICA8L3A+CisgICAgICA8L2F0dHJpYnV0ZT4KKworICAgICAgPGF0dHJpYnV0ZSBuYW1lPSJ0aHJl
c2hvbGQiIHJlcXVpcmVkPSJmYWxzZSI+CisgICAgICAgIDxwPk1pbmltdW0gZHVyYXRpb24gaW4g
c2Vjb25kcyBhZnRlciB3aGljaCBhIHRocmVhZCBpcyBjb25zaWRlcmVkIHN0dWNrLgorICAgICAg
ICBEZWZhdWx0IGlzIDYwMCBzZWNvbmRzLiBJZiBzZXQgdG8gMCwgdGhlIGRldGVjdGlvbiBpcyBk
aXNhYmxlZC48L3A+CisgICAgICAgIDxwPk5vdGU6IHNpbmNlIHRoZSBkZXRlY3Rpb24gaXMgZG9u
ZSBpbiB0aGUgYmFja2dyb3VuZCB0aHJlYWQgb2YgdGhlIENvbnRhaW5lcgorICAgICAgICAoRW5n
aW5lLCBIb3N0IG9yIENvbnRleHQpIGRlY2xhcmluZyB0aGlzIFZhbHZlLCB0aGUgdGhyZXNob2xk
IHNob3VsZCBiZSBoaWdoZXIKKyAgICAgICAgdGhhbiB0aGUgPGNvZGU+YmFja2dyb3VuZFByb2Nl
c3NvckRlbGF5PC9jb2RlPiBvZiB0aGlzIENvbnRhaW5lci48L3A+CisgICAgICA8L2F0dHJpYnV0
ZT4KKworICAgIDwvYXR0cmlidXRlcz4KKworICA8L3N1YnNlY3Rpb24+CisKKzwvc2VjdGlvbj4K
KworCiA8L2JvZHk+CiAKIAo=
</data>

          </attachment>
      

    </bug>

</bugzilla>